<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <style>
      :root {
        --c-bg: #fff;
      }

      html.dark {
        --c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.classList.toggle('dark', true)
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/lucy.ico"><title>SpringCloud | 彗星文档</title><meta name="description" content="繁星似海 熠熠生辉">
    <link rel="preload" href="/blogs/assets/style-CPtAZutf.css" as="style"><link rel="stylesheet" href="/blogs/assets/style-CPtAZutf.css">
    <link rel="modulepreload" href="/blogs/assets/app-CcpQiU3r.js"><link rel="modulepreload" href="/blogs/assets/springcloud.html-Bf7PxxJH.js">
    <link rel="prefetch" href="/blogs/assets/about.html-DhKeWU24.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DA8iLiyA.js" as="script"><link rel="prefetch" href="/blogs/assets/activiti.html-DDwChBnw.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-Bml-mFha.js" as="script"><link rel="prefetch" href="/blogs/assets/css.html-BkzZZsaD.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CNUn2TGk.js" as="script"><link rel="prefetch" href="/blogs/assets/design.html-CMiuAcak.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CgKRZVxN.js" as="script"><link rel="prefetch" href="/blogs/assets/datastructure.html-DxrDgJpj.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-Ditgvafn.js" as="script"><link rel="prefetch" href="/blogs/assets/docker.html-BN3DZ6pB.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CdwC3DvO.js" as="script"><link rel="prefetch" href="/blogs/assets/elk1.html-TuHG9Qis.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-7YiMg99q.js" as="script"><link rel="prefetch" href="/blogs/assets/elk2.html-D_t4npT9.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-B8Xt1Y-P.js" as="script"><link rel="prefetch" href="/blogs/assets/html.html-BQ17VAk5.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DCb-lvEs.js" as="script"><link rel="prefetch" href="/blogs/assets/abnormal.html-Chq3b_Cu.js" as="script"><link rel="prefetch" href="/blogs/assets/api.html-CwQB4xkY.js" as="script"><link rel="prefetch" href="/blogs/assets/base.html-eJmjEDUX.js" as="script"><link rel="prefetch" href="/blogs/assets/encapsulation.html-BUX2cecZ.js" as="script"><link rel="prefetch" href="/blogs/assets/Inheritance.html-DqMfhn6j.js" as="script"><link rel="prefetch" href="/blogs/assets/JVM.html-DUBzNQrN.js" as="script"><link rel="prefetch" href="/blogs/assets/other.html-BXasSOZ_.js" as="script"><link rel="prefetch" href="/blogs/assets/polymorphism.html-CDG0VkNL.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BFEB-8Vy.js" as="script"><link rel="prefetch" href="/blogs/assets/jdbc.html-DZjJ-evB.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-D6kvzE4O.js" as="script"><link rel="prefetch" href="/blogs/assets/collection.html-CBYSZ1IC.js" as="script"><link rel="prefetch" href="/blogs/assets/enum.html-EN1aytni.js" as="script"><link rel="prefetch" href="/blogs/assets/format.html-3XuRGjWn.js" as="script"><link rel="prefetch" href="/blogs/assets/Generics.html-BJdl0s58.js" as="script"><link rel="prefetch" href="/blogs/assets/iostream.html-myQJ2rG1.js" as="script"><link rel="prefetch" href="/blogs/assets/NIO.html-kfw4RbBk.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-fVZ3OQWt.js" as="script"><link rel="prefetch" href="/blogs/assets/reflection.html-C2ixvrpE.js" as="script"><link rel="prefetch" href="/blogs/assets/socket.html-uyDUQT7a.js" as="script"><link rel="prefetch" href="/blogs/assets/thread.html-CqD1JJ-m.js" as="script"><link rel="prefetch" href="/blogs/assets/tree.html-DgbggWKL.js" as="script"><link rel="prefetch" href="/blogs/assets/js.html-BtFscr3o.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BB1yvwvx.js" as="script"><link rel="prefetch" href="/blogs/assets/log.html-yXne49fo.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-e-BayhWp.js" as="script"><link rel="prefetch" href="/blogs/assets/maven.html-VpFl_Wv8.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CZNcp4uo.js" as="script"><link rel="prefetch" href="/blogs/assets/message.html-BpII8JS5.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DAzo0xh2.js" as="script"><link rel="prefetch" href="/blogs/assets/mybatis.html-BOaJ_dhM.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-FNtzrmz-.js" as="script"><link rel="prefetch" href="/blogs/assets/mybatisplus.html-rmFUgU9Z.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CNbXNMZz.js" as="script"><link rel="prefetch" href="/blogs/assets/mysql-base.html-CmE_MNx8.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DnnNdUeL.js" as="script"><link rel="prefetch" href="/blogs/assets/mysql-rise.html-CEpflt3I.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DHrCa3V_.js" as="script"><link rel="prefetch" href="/blogs/assets/archive1.html-Cai2XpOE.js" as="script"><link rel="prefetch" href="/blogs/assets/archive2.html-BjJxha2u.js" as="script"><link rel="prefetch" href="/blogs/assets/article1.html-aK40L1s2.js" as="script"><link rel="prefetch" href="/blogs/assets/article10.html-Cijx5V1M.js" as="script"><link rel="prefetch" href="/blogs/assets/article11.html-Bkr68J-D.js" as="script"><link rel="prefetch" href="/blogs/assets/article12.html-2qfGRPQ1.js" as="script"><link rel="prefetch" href="/blogs/assets/article2.html-CMQLgjSp.js" as="script"><link rel="prefetch" href="/blogs/assets/article3.html-DUyWKXuz.js" as="script"><link rel="prefetch" href="/blogs/assets/article4.html-C4BY5QJH.js" as="script"><link rel="prefetch" href="/blogs/assets/article5.html-DvWRcuDh.js" as="script"><link rel="prefetch" href="/blogs/assets/article6.html-VvpWFuwM.js" as="script"><link rel="prefetch" href="/blogs/assets/article7.html-CBtcSf6e.js" as="script"><link rel="prefetch" href="/blogs/assets/article8.html-CzJv_xcv.js" as="script"><link rel="prefetch" href="/blogs/assets/article9.html-CKUCv5d8.js" as="script"><link rel="prefetch" href="/blogs/assets/sticky.html-D1sngRmP.js" as="script"><link rel="prefetch" href="/blogs/assets/sticky2.html-CqF7wU_R.js" as="script"><link rel="prefetch" href="/blogs/assets/nginx.html-DmbyItFM.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DfHEMTTs.js" as="script"><link rel="prefetch" href="/blogs/assets/questions.html-CAk0Pi-5.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-Ci546QP9.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-C1ag7zEi.js" as="script"><link rel="prefetch" href="/blogs/assets/redis.html-cqnu907y.js" as="script"><link rel="prefetch" href="/blogs/assets/rabbitmq.html-LV1UAa_S.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CUfeR6Us.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DXLASCiH.js" as="script"><link rel="prefetch" href="/blogs/assets/rocketmq.html-B6FMME_e.js" as="script"><link rel="prefetch" href="/blogs/assets/buy1.html-CfxDtzlh.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CnFC8VGM.js" as="script"><link rel="prefetch" href="/blogs/assets/buy2.html-DBSLCkot.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BEoYdsUT.js" as="script"><link rel="prefetch" href="/blogs/assets/buy3.html-y5wBBWab.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-B4Vacypf.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BpWOZ7NJ.js" as="script"><link rel="prefetch" href="/blogs/assets/sort.html-DSCWxSvI.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DHLWb9co.js" as="script"><link rel="prefetch" href="/blogs/assets/spring.html-C1Nxzn9A.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DtvSsS7w.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BFVCXPgT.js" as="script"><link rel="prefetch" href="/blogs/assets/springboot.html-Bklxwtol.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-C9qIG9dc.js" as="script"><link rel="prefetch" href="/blogs/assets/springcloudalibaba.html-tewgLMTx.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-NJzZPzpD.js" as="script"><link rel="prefetch" href="/blogs/assets/springdata-jpa.html-CmoxyOGj.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DFeOnff6.js" as="script"><link rel="prefetch" href="/blogs/assets/springmvc.html-5pshC_ca.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BeoGrk5e.js" as="script"><link rel="prefetch" href="/blogs/assets/springsecurity.html-DMaMGfdR.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DlpbHnWO.js" as="script"><link rel="prefetch" href="/blogs/assets/ssm.html-bm6q5ESo.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CJp7MWGX.js" as="script"><link rel="prefetch" href="/blogs/assets/git.html-B_PW17ry.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BOcdAHT9.js" as="script"><link rel="prefetch" href="/blogs/assets/linux.html-y5gRqKzr.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-Di-ESnM4.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CoqjZUb6.js" as="script"><link rel="prefetch" href="/blogs/assets/web.html-BhJmfKr8.js" as="script"><link rel="prefetch" href="/blogs/assets/404.html-BoxbHgG_.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BCGo9e-C.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-Brg7_Art.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-B8JZZvVX.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DqED4BkN.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DIfkW4xP.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DO7nE8O-.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-8ctw3jHJ.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BGz98Uu_.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-B2IhqRI1.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DhGzT4FS.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-CN1dajXa.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-BEHJNuEt.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DQLEftrF.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-kTf1nhRF.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-DLTJlrMo.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon"><!--[--><header class="vp-navbar"><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blogs/"><img class="vp-site-logo" src="/blogs/comet.png" alt="彗星文档"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">彗星文档</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/" aria-label="主页"><!---->主页<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/about.html" aria-label="关于"><!---->关于<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/study-direction/" aria-label="学习路线"><!---->学习路线<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaSE"><span class="title">JavaSE</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaSE"><span class="title">JavaSE</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>JavaSE上</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/JavaSE1/" aria-label="1.基础~8.异常处理"><!---->1.基础~8.异常处理<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>JavaSE下</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/JavaSE2/" aria-label="9.泛型~18.正则表达式"><!---->9.泛型~18.正则表达式<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="运维工具"><span class="title">运维工具</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="运维工具"><span class="title">运维工具</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>虚拟机</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/virtual-system/" aria-label="Linux"><!---->Linux<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>多人协同</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/tools/" aria-label="Git"><!---->Git<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>镜像</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/docker/" aria-label="Docker"><!---->Docker<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>工作流</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/activiti/" aria-label="Activiti工作流引擎"><!---->Activiti工作流引擎<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>MySQL</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/mysql1/" aria-label="MySQL上"><!---->MySQL上<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/mysql2/" aria-label="MySQL下"><!---->MySQL下<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaWeb"><span class="title">JavaWeb</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaWeb"><span class="title">JavaWeb</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/jdbc/" aria-label="1.JDBC"><!---->1.JDBC<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/html/" aria-label="2.HTML"><!---->2.HTML<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/css/" aria-label="3.CSS"><!---->3.CSS<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/js/" aria-label="4.JS"><!---->4.JS<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/web/" aria-label="5.Web"><!---->5.Web<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/log/" aria-label="1.日志"><!---->1.日志<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/maven/" aria-label="2.Maven"><!---->2.Maven<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/design/" aria-label="3.设计模式"><!---->3.设计模式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/mybatis/" aria-label="4.MyBatis"><!---->4.MyBatis<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/spring/" aria-label="5.Spring"><!---->5.Spring<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springmvc/" aria-label="6.SpringMVC"><!---->6.SpringMVC<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/mybatis-plus/" aria-label="7.MyBatisPlus"><!---->7.MyBatisPlus<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/redis/" aria-label="8.Redis"><!---->8.Redis<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springboot/" aria-label="9.SpringBoot"><!---->9.SpringBoot<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springdata-jpa/" aria-label="10.SpringData-jpa"><!---->10.SpringData-jpa<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springsecurity/" aria-label="11.SpringSecurity"><!---->11.SpringSecurity<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="分布式组件"><span class="title">分布式组件</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="分布式组件"><span class="title">分布式组件</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/nginx/" aria-label="1.Nginx"><!---->1.Nginx<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/blogs/springcloud/" aria-label="2.SpringCloud"><!---->2.SpringCloud<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springcloud-alibaba/" aria-label="3.SprngCloud-AliBaBa"><!---->3.SprngCloud-AliBaBa<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/elk1/" aria-label="4.ELK(上)"><!---->4.ELK(上)<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/elk2/" aria-label="5.ELK(下)"><!---->5.ELK(下)<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/rocketmq/" aria-label="6.RocketMQ"><!---->6.RocketMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/rabbitmq/" aria-label="7.RabbitMQ"><!---->7.RabbitMQ<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="项目"><span class="title">项目</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="项目"><span class="title">项目</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>综合项目</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/ssm/" aria-label="1.SSM小项目"><!---->1.SSM小项目<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/message/" aria-label="2.短信调度"><!---->2.短信调度<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/shopping1/" aria-label="二手交易网(上)"><!---->二手交易网(上)<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/shopping2/" aria-label="二手交易网(中)"><!---->二手交易网(中)<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/shopping3/" aria-label="二手交易网(下)"><!---->二手交易网(下)<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/sort/" aria-label="1.排序算法"><!---->1.排序算法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/datastructure/" aria-label="2.基本数据结构与算法"><!---->2.基本数据结构与算法<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/question/" aria-label="遇到的问题"><!---->遇到的问题<!----></a></div><!--]--></nav><!--[--><!--]--><button class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar"><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/" aria-label="主页"><!---->主页<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/about.html" aria-label="关于"><!---->关于<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/study-direction/" aria-label="学习路线"><!---->学习路线<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaSE"><span class="title">JavaSE</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaSE"><span class="title">JavaSE</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>JavaSE上</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/JavaSE1/" aria-label="1.基础~8.异常处理"><!---->1.基础~8.异常处理<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>JavaSE下</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/JavaSE2/" aria-label="9.泛型~18.正则表达式"><!---->9.泛型~18.正则表达式<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="运维工具"><span class="title">运维工具</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="运维工具"><span class="title">运维工具</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>虚拟机</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/virtual-system/" aria-label="Linux"><!---->Linux<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>多人协同</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/tools/" aria-label="Git"><!---->Git<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>镜像</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/docker/" aria-label="Docker"><!---->Docker<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>工作流</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/activiti/" aria-label="Activiti工作流引擎"><!---->Activiti工作流引擎<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>MySQL</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/mysql1/" aria-label="MySQL上"><!---->MySQL上<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/mysql2/" aria-label="MySQL下"><!---->MySQL下<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="JavaWeb"><span class="title">JavaWeb</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="JavaWeb"><span class="title">JavaWeb</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/jdbc/" aria-label="1.JDBC"><!---->1.JDBC<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/html/" aria-label="2.HTML"><!---->2.HTML<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/css/" aria-label="3.CSS"><!---->3.CSS<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/js/" aria-label="4.JS"><!---->4.JS<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/web/" aria-label="5.Web"><!---->5.Web<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/log/" aria-label="1.日志"><!---->1.日志<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/maven/" aria-label="2.Maven"><!---->2.Maven<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/design/" aria-label="3.设计模式"><!---->3.设计模式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/mybatis/" aria-label="4.MyBatis"><!---->4.MyBatis<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/spring/" aria-label="5.Spring"><!---->5.Spring<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springmvc/" aria-label="6.SpringMVC"><!---->6.SpringMVC<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/mybatis-plus/" aria-label="7.MyBatisPlus"><!---->7.MyBatisPlus<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/redis/" aria-label="8.Redis"><!---->8.Redis<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springboot/" aria-label="9.SpringBoot"><!---->9.SpringBoot<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springdata-jpa/" aria-label="10.SpringData-jpa"><!---->10.SpringData-jpa<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springsecurity/" aria-label="11.SpringSecurity"><!---->11.SpringSecurity<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="分布式组件"><span class="title">分布式组件</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="分布式组件"><span class="title">分布式组件</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/nginx/" aria-label="1.Nginx"><!---->1.Nginx<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/blogs/springcloud/" aria-label="2.SpringCloud"><!---->2.SpringCloud<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/springcloud-alibaba/" aria-label="3.SprngCloud-AliBaBa"><!---->3.SprngCloud-AliBaBa<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/elk1/" aria-label="4.ELK(上)"><!---->4.ELK(上)<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/elk2/" aria-label="5.ELK(下)"><!---->5.ELK(下)<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/rocketmq/" aria-label="6.RocketMQ"><!---->6.RocketMQ<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/rabbitmq/" aria-label="7.RabbitMQ"><!---->7.RabbitMQ<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="项目"><span class="title">项目</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="项目"><span class="title">项目</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>综合项目</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/ssm/" aria-label="1.SSM小项目"><!---->1.SSM小项目<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/message/" aria-label="2.短信调度"><!---->2.短信调度<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/shopping1/" aria-label="二手交易网(上)"><!---->二手交易网(上)<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/shopping2/" aria-label="二手交易网(中)"><!---->二手交易网(中)<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blogs/shopping3/" aria-label="二手交易网(下)"><!---->二手交易网(下)<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/sort/" aria-label="1.排序算法"><!---->1.排序算法<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blogs/datastructure/" aria-label="2.基本数据结构与算法"><!---->2.基本数据结构与算法<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blogs/question/" aria-label="遇到的问题"><!---->遇到的问题<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active collapsible">目录 <span class="down arrow"></span></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/blogs/springcloud/springcloud.html" aria-label="SpringCloud"><!---->SpringCloud<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="springcloud" tabindex="-1"><a class="header-anchor" href="#springcloud"><span>SpringCloud</span></a></h1><h2 id="springcloud-课程介绍" tabindex="-1"><a class="header-anchor" href="#springcloud-课程介绍"><span>SpringCloud：课程介绍</span></a></h2><h3 id="_1、前置" tabindex="-1"><a class="header-anchor" href="#_1、前置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81%E5%89%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>1、前置</span></a></h3><p>javaSE,javaEE,SSM,Boot</p><p>为什么：一线城市，上了规模大厂、中厂，都需要cloud。</p><p>cloud,薪资高</p><h3 id="_2、特点" tabindex="-1"><a class="header-anchor" href="#_2、特点"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81%E7%89%B9%E7%82%B9" target="_blank" rel="noopener noreferrer">#</a>2、特点</span></a></h3><p>各大机构视频教程、网络文章、spring官网以及本人8年的java开发经验。</p><p>跟着本课程，写就可以了。</p><p>入门课程，会用cloud。</p><h3 id="_3、如何学习" tabindex="-1"><a class="header-anchor" href="#_3、如何学习"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_3%E3%80%81%E5%A6%82%E4%BD%95%E5%AD%A6%E4%B9%A0" target="_blank" rel="noopener noreferrer">#</a>3、如何学习</span></a></h3><p>保姆级教程。</p><p>代码和课程图片粘贴md格式的文档上面。</p><p>倍速播放。关闭弹幕。</p><p>学完一个知识点，有任何问题，弹幕、评论、粉丝群大家讨论。</p><h3 id="_4、面向人员" tabindex="-1"><a class="header-anchor" href="#_4、面向人员"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_4%E3%80%81%E9%9D%A2%E5%90%91%E4%BA%BA%E5%91%98" target="_blank" rel="noopener noreferrer">#</a>4、面向人员</span></a></h3><p>大学生朋友：大学当中，科班非科班，毕业找一份java工作，没问题。</p><p>工作1-3年朋友：自己行业又累薪资又低。4-6个月，坚持下来，转行找到java开发职位没问题。</p><h3 id="_5、心态" tabindex="-1"><a class="header-anchor" href="#_5、心态"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_5%E3%80%81%E5%BF%83%E6%80%81" target="_blank" rel="noopener noreferrer">#</a>5、心态</span></a></h3><p>太简单了、太难。 我不是RMB,做不到14亿人都喜欢。 右上角有个X,点击一下退出可以了。</p><p>不要吃饱了骂厨子、念完经打和尚、过河拆桥。</p><p>Talk is cheap ,show me the code 。 坚持。30小结。都看完，知识就是你的了。</p><p>欢迎大家，一键三连。</p><h3 id="_6、获取资料" tabindex="-1"><a class="header-anchor" href="#_6、获取资料"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_6%E3%80%81%E8%8E%B7%E5%8F%96%E8%B5%84%E6%96%99" target="_blank" rel="noopener noreferrer">#</a>6、获取资料</span></a></h3><p>www.ydlclass.com 文档区，免费下载即可。</p><p>我<strong>itlils</strong>和楠哥<strong>itnanls</strong> java学习整套路径，列出来。 <strong>教程都由我和楠哥亲自录制</strong>。 免费自学java成功。</p><p>案例：免费自学，java工作，应届生，一线，10k。</p><p>随时一对一解决问题，规划，简历修改。加入我们会员。</p><h2 id="第一章-springcloud简介" tabindex="-1"><a class="header-anchor" href="#第一章-springcloud简介"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E4%B8%80%E7%AB%A0-springcloud%E7%AE%80%E4%BB%8B" target="_blank" rel="noopener noreferrer">#</a>第一章 SpringCloud简介</span></a></h2><h3 id="一、-软件架构演进" tabindex="-1"><a class="header-anchor" href="#一、-软件架构演进"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81-%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B" target="_blank" rel="noopener noreferrer">#</a>一、 软件架构演进</span></a></h3><p>单体架构</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220328172416767.61fb5e07.png" alt="image-20220328172416767"></p><p>垂直架构</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220328172721883.2d51c59e.png" alt="image-20220328172721883"></p><p>分布式架构</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220328173112642.b0ee1ce2.png" alt="image-20220328173112642"></p><p>SOA架构</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220328174118241.23f135ec.png" alt="image-20220328174118241"></p><p>微服务架构</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220328174633493.6d3e8f1b.png" alt="image-20220328174633493"></p><h3 id="二、微服务架构" tabindex="-1"><a class="header-anchor" href="#二、微服务架构"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" target="_blank" rel="noopener noreferrer">#</a>二、微服务架构</span></a></h3><h4 id="_1、-微服务理念" tabindex="-1"><a class="header-anchor" href="#_1、-微服务理念"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%90%86%E5%BF%B5" target="_blank" rel="noopener noreferrer">#</a>1、 微服务理念</span></a></h4><p>①&quot;微服务”一词源 于 Martin Fowler的名为 Microservices的博文,可以在他的官方博客上找到http://martinfowler.com/articles/microservices.html</p><p>②微服务是系统架构上的一种设计风格,它的主旨是将一个原本独立的系统拆分成多个小型服务,这些小型服务都在各自独立的进程中运行,服务之间一般通过 HTTP 的 RESTfuL API 进行通信协作。</p><p><strong>restfull 风格</strong>：数据的增删改查，使用http的不同方式。数据传输用json。</p><p>查询 GET ip:port/user/1</p><p>新增 POST ip:port/user json{username:itlils,age:18}</p><p>修改 PUT ip:port/user/1 json{username:itlils,age:19}</p><p>删除 DELETE ip:port/user/1</p><p>③由于有了轻量级的通信协作基础,所以这些微服务可以使用不同的语言来编写。大厂，各种语言混用。</p><p>cloud官网: https://spring.io/</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329154419410.35fc4235.png" alt="image-20220329154419410"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329152020956.6168854b.png" alt="image-20220329152020956"></p><h4 id="_2、-现在大型互联网公司-都在使用微服务架构" tabindex="-1"><a class="header-anchor" href="#_2、-现在大型互联网公司-都在使用微服务架构"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81-%E7%8E%B0%E5%9C%A8%E5%A4%A7%E5%9E%8B%E4%BA%92%E8%81%94%E7%BD%91%E5%85%AC%E5%8F%B8-%E9%83%BD%E5%9C%A8%E4%BD%BF%E7%94%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" target="_blank" rel="noopener noreferrer">#</a>2、 现在大型互联网公司，都在使用微服务架构：</span></a></h4><p>京东的促销节架构：618</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329152531517.e9aa4638.png" alt="image-20220329152531517"></p><p>阿里的架构：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329152552588.ea1b80bc.png" alt="image-20220329152552588"></p><p>京东物流的架构：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329152611053.1bdac904.png" alt="image-20220329152611053"></p><h4 id="_3、-springcloud组件" tabindex="-1"><a class="header-anchor" href="#_3、-springcloud组件"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_3%E3%80%81-springcloud%E7%BB%84%E4%BB%B6" target="_blank" rel="noopener noreferrer">#</a>3、 springcloud组件：</span></a></h4><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329152758773.9e65bcd2.png" alt="image-20220329152758773"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329153147800.c1b6698c.png" alt="image-20220329153147800"></p><h2 id="第二章-走进springcloud" tabindex="-1"><a class="header-anchor" href="#第二章-走进springcloud"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E8%B5%B0%E8%BF%9Bspringcloud" target="_blank" rel="noopener noreferrer">#</a>第二章 走进springcloud</span></a></h2><h3 id="一、了解springcloud" tabindex="-1"><a class="header-anchor" href="#一、了解springcloud"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81%E4%BA%86%E8%A7%A3springcloud" target="_blank" rel="noopener noreferrer">#</a>一、了解springcloud</span></a></h3><p>①Spring Cloud 是<strong>一系列框架</strong>的有序集合。</p><p>②Spring Cloud 并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来。</p><p>netflix eureka 1.1,alibaba 2.2</p><p>③通过 <strong>Spring Boot</strong> 风格进行再封装,屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。</p><p>④它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、 断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。</p><p>⑤Spring Cloud项目官方网址：https://spring.io/projects/spring-cloud</p><p>⑥Spring Cloud 版本命名方式采用了<strong>伦敦地铁站的名称</strong>，同时根据字母表的顺序来对应版本时间顺序，比如：最早的Release版本：Angel，第二个Release版本：Brixton，然后是Camden、Dalston、Edgware，Finchley，Greenwich，Hoxton。</p><p>目前最新的是2021.0.1版本。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329161144299.73a4c7f1.png" alt="image-20220329161144299"></p><h3 id="二、-cloud与boot版本对应关系" tabindex="-1"><a class="header-anchor" href="#二、-cloud与boot版本对应关系"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81-cloud%E4%B8%8Eboot%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB" target="_blank" rel="noopener noreferrer">#</a>二、 cloud与boot版本对应关系</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329164540295.576a76f5.png" alt="image-20220329164540295"></p><h3 id="三、-dubbo对比" tabindex="-1"><a class="header-anchor" href="#三、-dubbo对比"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81-dubbo%E5%AF%B9%E6%AF%94" target="_blank" rel="noopener noreferrer">#</a>三、 dubbo对比</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329161102849.d44ade71.png" alt="image-20220329161102849"></p><p><strong>相同点</strong>：Spring Cloud 与 Dubbo 都是实现微服务有效的工具。</p><p><strong>不同点</strong>：</p><p>1Dubbo 只是实现了服务治理，而 Spring Cloud 子项目分别覆盖了微服务架构下的众多部件。</p><p>2Dubbo 使用 RPC 通讯协议，Spring Cloud 使用 RESTful 完成通信，Dubbo 效率略高于 Spring Cloud。</p><p><strong>小结</strong></p><p>• 微服务就是将项目的各个模块拆分为可独立运行、部署、测试的架构设计风格。</p><p>• Spring 公司将其他公司中微服务架构常用的组件整合起来，并使用 SpringBoot 简化其开发、配置。称为 Spring Cloud。</p><p>• Spring Cloud 与 Dubbo都是实现微服务有效的工具。Dubbo 性能更好，而 Spring Cloud 功能更全面。Dubbo 已经融入到spingcloudAlibaba这一套</p><p><strong>本课程技术特点</strong>： 两套springcloud.</p><ol><li><p>5年前的项目。springcloud netflix(eureka config hystrix) hoxton。会讲到。</p></li><li><p>新项目 springcloud alibaba(nacos sentinel)。也会讲到。</p></li></ol><h2 id="第三章-停更-升级-替换" tabindex="-1"><a class="header-anchor" href="#第三章-停更-升级-替换"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%81%9C%E6%9B%B4-%E5%8D%87%E7%BA%A7-%E6%9B%BF%E6%8D%A2" target="_blank" rel="noopener noreferrer">#</a>第三章 停更/升级/替换</span></a></h2><p>红色不维护。</p><p>绿色是alibaba一套，推荐使用。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220329171255668.cddd16e1.png" alt="image-20220329171255668"></p><h2 id="第四章-微服务架构编码构建" tabindex="-1"><a class="header-anchor" href="#第四章-微服务架构编码构建"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA" target="_blank" rel="noopener noreferrer">#</a>第四章 微服务架构编码构建</span></a></h2><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220404103923982.85c56e15.png" alt="image-20220404103923982"></p><h3 id="一、-搭建-provider-和-consumer-服务" tabindex="-1"><a class="header-anchor" href="#一、-搭建-provider-和-consumer-服务"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81-%E6%90%AD%E5%BB%BA-provider-%E5%92%8C-consumer-%E6%9C%8D%E5%8A%A1" target="_blank" rel="noopener noreferrer">#</a>一、 搭建 Provider 和 Consumer 服务</span></a></h3><h4 id="_1、父工程-spring-cloud-parent" tabindex="-1"><a class="header-anchor" href="#_1、父工程-spring-cloud-parent"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81%E7%88%B6%E5%B7%A5%E7%A8%8B-spring-cloud-parent" target="_blank" rel="noopener noreferrer">#</a>1、父工程 spring-cloud-parent</span></a></h4><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220404103149867.f3234ca1.png" alt="image-20220404103149867"></p><p>使用utf-8编码</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220404103334670.9bfcbddd.png" alt="image-20220404103334670"></p><p>maven设置</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220404103417399.f4982f5b.png" alt="image-20220404103417399"></p><p>pom.xml</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!--spring boot 环境 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.11.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    </span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26</p><h4 id="_2、提供者-eureka-provider" tabindex="-1"><a class="header-anchor" href="#_2、提供者-eureka-provider"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81%E6%8F%90%E4%BE%9B%E8%80%85-eureka-provider" target="_blank" rel="noopener noreferrer">#</a>2、提供者 eureka-provider</span></a></h4><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220330164728077.62e821de.png" alt="image-20220330164728077"></p><p>搭建springboot工程：步骤把大象装冰箱有几步？ 工作中别问同事</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">1 pom 导包</span>
<span class="line">2 配置文件</span>
<span class="line">3 主启动类</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3</p><p>pom.xml</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>eureka-provider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26</p><p>application.yml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">server:</span>
<span class="line">  port: 8000</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2</p><p>主启动类 ProviderApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProviderApplication</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ProviderApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17</p><p>Goods</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Goods</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span><span class="token comment">//商品id</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span><span class="token comment">//商品名</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">double</span> price<span class="token punctuation">;</span><span class="token comment">//价格</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span><span class="token comment">//库存</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&quot;Goods{&quot;</span> <span class="token operator">+</span></span>
<span class="line">                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span></span>
<span class="line">                <span class="token string">&quot;, title=&#39;&quot;</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token char">&#39;\&#39;&#39;</span> <span class="token operator">+</span></span>
<span class="line">                <span class="token string">&quot;, price=&quot;</span> <span class="token operator">+</span> price <span class="token operator">+</span></span>
<span class="line">                <span class="token string">&quot;, count=&quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span></span>
<span class="line">                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> title<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> price<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> count<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65</p><p>GoodsController</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">GoodsService</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/goods&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsController</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token class-name">GoodsService</span> goodsService<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;findById/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods <span class="token operator">=</span> goodsService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28</p><p>GoodsService</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">GoodsDao</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Service</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsService</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token class-name">GoodsDao</span> goodsDao<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods <span class="token operator">=</span> goodsDao<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23</p><p>GoodsDao</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Repository</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsDao</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//查数据库</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18</p><p><strong>测试：</strong></p><p>访问：http://localhost:8000/goods/findById/1</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220330170647529.2bf7e1c4.png" alt="image-20220330170647529"></p><h4 id="_3、消费者-eureka-consumer" tabindex="-1"><a class="header-anchor" href="#_3、消费者-eureka-consumer"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_3%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85-eureka-consumer" target="_blank" rel="noopener noreferrer">#</a>3、消费者 eureka-consumer</span></a></h4><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220404111105516.f67f7a56.png" alt="image-20220404111105516"></p><p>pom.xml</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>eureka-consumer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">&lt;!--spring boot web--&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24</p><p>Goods</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 商品实体类</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Goods</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span><span class="token comment">//商品标题</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">double</span> price<span class="token punctuation">;</span><span class="token comment">//商品价格</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span><span class="token comment">//商品库存</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> title<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> price<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> count<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54</p><p>OrderController</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/order&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//业务逻辑</span></span>
<span class="line">        <span class="token comment">//1查询商品</span></span>
<span class="line">        <span class="token comment">//2减库存</span></span>
<span class="line">        <span class="token comment">//3支付</span></span>
<span class="line">        <span class="token comment">//4物流</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2</p><p><strong>测试：</strong></p><p>http://localhost:9000/order/add/2</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220404112103333.e5ed7fec.png" alt="image-20220404112103333"></p><h3 id="二、使用-resttemplate-完成远程调用" tabindex="-1"><a class="header-anchor" href="#二、使用-resttemplate-完成远程调用"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8-resttemplate-%E5%AE%8C%E6%88%90%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8" target="_blank" rel="noopener noreferrer">#</a>二、使用 RestTemplate 完成远程调用</span></a></h3><ul><li>Spring提供的一种简单便捷的模板类，用于在 java 代码里访问 restful 服务。</li><li>其功能与 HttpClient 类似，但是 RestTemplate 实现更优雅，使用更方便。</li></ul><p><strong>consumer工程中</strong></p><p>RestTemplateConfig</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestTemplateConfig</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16</p><p>OrderController</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 服务的调用方</span>
<span class="line"> */</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/order&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/goods/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findGoodsById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;findGoodsById...&quot;</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">        <span class="token comment">/*</span>
<span class="line">            //远程调用Goods服务中的findOne接口</span>
<span class="line">            使用RestTemplate</span>
<span class="line">            1. 定义Bean  restTemplate</span>
<span class="line">            2. 注入Bean</span>
<span class="line">            3. 调用方法</span>
<span class="line">         */</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8000/goods/findOne/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 3. 调用方法</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token class-name">Goods</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43</p><p><strong>测试：</strong></p><h2 id="第五章-eureka服务注册与发现" tabindex="-1"><a class="header-anchor" href="#第五章-eureka服务注册与发现"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E4%BA%94%E7%AB%A0-eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0" target="_blank" rel="noopener noreferrer">#</a>第五章 Eureka服务注册与发现</span></a></h2><h3 id="一、eureka" tabindex="-1"><a class="header-anchor" href="#一、eureka"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81eureka" target="_blank" rel="noopener noreferrer">#</a>一、Eureka</span></a></h3><p><strong>概念：</strong></p><p>• Eureka 是 Netflix 公司开源的一个服务注册与发现的组件 。</p><p>• Eureka 和其他 Netflix 公司的服务组件（例如负载均衡、熔断器、网关等） 一起，被 Spring Cloud 社区整合为Spring-Cloud-Netflix 模块。</p><p>• Eureka 包含两个组件：Eureka Server (注册中心) 和 Eureka Client (服务提供者、服务消费者)。</p><p><strong>操作：</strong></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200606113829765-1648628667299.b0fb85d7.png" alt="image-20200606113829765"></p><h3 id="二、-搭建-eureka-server-服务" tabindex="-1"><a class="header-anchor" href="#二、-搭建-eureka-server-服务"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81-%E6%90%AD%E5%BB%BA-eureka-server-%E6%9C%8D%E5%8A%A1" target="_blank" rel="noopener noreferrer">#</a>二、 搭建 Eureka Server 服务</span></a></h3><p>（1）创建 eureka-server 模块</p><p>（2） 引入 SpringCloud 和 euraka-server 相关依赖</p><p>（3）完成 Eureka Server 相关配置</p><p>（4）启动该模块</p><p><strong>父工程 pom</strong></p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>eureka-provider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>eureka-consumer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!--spring boot 环境 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!--spring cloud 版本--&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>Greenwich.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">&lt;!--引入Spring Cloud 依赖--&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48</p><p><strong>eureka-server工程</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">&lt;!-- eureka-server --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</p><p>EurekaApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>eureka</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">EnableEurekaServer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token comment">// 启用EurekaServer</span></span>
<span class="line"><span class="token annotation punctuation">@EnableEurekaServer</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaApp</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EurekaApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8761</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># eureka 配置</span></span>
<span class="line"><span class="token comment"># eureka 一共有4部分 配置</span></span>
<span class="line"><span class="token comment"># 1. dashboard:eureka的web控制台配置</span></span>
<span class="line"><span class="token comment"># 2. server:eureka的服务端配置</span></span>
<span class="line"><span class="token comment"># 3. client:eureka的客户端配置</span></span>
<span class="line"><span class="token comment"># 4. instance:eureka的实例配置</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>eureka.instance.hostname<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>/eureka <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line"></span>
<span class="line">    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否将自己的路径 注册到eureka上。eureka server 不需要的，eureka provider client 需要</span></span>
<span class="line">    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否需要从eureka中抓取路径。eureka server 不需要的，eureka consumer client 需要</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</p><p>**测试： ** 访问 localhost:8761</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200611013357920.c3a39136.png" alt="image-20200611013357920"></p><h3 id="三、-改造-provider-和-consumer-称为-eureka-client" tabindex="-1"><a class="header-anchor" href="#三、-改造-provider-和-consumer-称为-eureka-client"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81-%E6%94%B9%E9%80%A0-provider-%E5%92%8C-consumer-%E7%A7%B0%E4%B8%BA-eureka-client" target="_blank" rel="noopener noreferrer">#</a>三、 改造 Provider 和 Consumer 称为 Eureka Client</span></a></h3><p>① 引 eureka-client 相关依赖</p><p>② 完成 eureka client 相关配置</p><p>③ 启动 测试</p><p><strong>Provider工程</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">        <span class="token comment">&lt;!-- eureka-client --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p><p>ProviderApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@EnableEurekaClient</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>provider <span class="token comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13</p><p><strong>Consumer</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">        <span class="token comment">&lt;!-- eureka-client --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p><p>ConsumerApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span></span><span class="token class-name">EnableEurekaClient</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">// 激活DiscoveryClient</span></span>
<span class="line"><span class="token annotation punctuation">@EnableEurekaClient</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerApp</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConsumerApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>consumer <span class="token comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12</p><h3 id="四、-consumer-服务-通过从-eureka-server-中抓取-provider-地址-完成远程调用" tabindex="-1"><a class="header-anchor" href="#四、-consumer-服务-通过从-eureka-server-中抓取-provider-地址-完成远程调用"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E5%9B%9B%E3%80%81-consumer-%E6%9C%8D%E5%8A%A1-%E9%80%9A%E8%BF%87%E4%BB%8E-eureka-server-%E4%B8%AD%E6%8A%93%E5%8F%96-provider-%E5%9C%B0%E5%9D%80-%E5%AE%8C%E6%88%90%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8" target="_blank" rel="noopener noreferrer">#</a>四、 Consumer 服务 通过从 Eureka Server 中抓取 Provider 地址，完成远程调用</span></a></h3><p><strong>Consumer</strong></p><p>OrderController</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ServiceInstance</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">DiscoveryClient</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/order&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//业务逻辑</span></span>
<span class="line">        <span class="token comment">//1查询商品</span></span>
<span class="line">        <span class="token comment">//2减库存</span></span>
<span class="line">        <span class="token comment">//3支付</span></span>
<span class="line">        <span class="token comment">//4物流</span></span>
<span class="line">        <span class="token comment">//直接调用</span></span>
<span class="line">        <span class="token comment">//String url=&quot;http://localhost:8000/goods/findById/&quot;+id;</span></span>
<span class="line">        <span class="token comment">//Goods goods = restTemplate.getForObject(url, Goods.class);</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//服务发现</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">&quot;EUREKA-PROVIDER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>instances<span class="token operator">==</span><span class="token keyword">null</span><span class="token operator">||</span>instances<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">//通过某个策略拿到一个实例</span></span>
<span class="line">        <span class="token class-name">ServiceInstance</span> serviceInstance <span class="token operator">=</span> instances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> host <span class="token operator">=</span> serviceInstance<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">int</span> port <span class="token operator">=</span> serviceInstance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">&quot;http://&quot;</span><span class="token operator">+</span>host<span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span>port<span class="token operator">+</span><span class="token string">&quot;/goods/findById/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token class-name">Goods</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58</p><h3 id="五、-euraka配置详解" tabindex="-1"><a class="header-anchor" href="#五、-euraka配置详解"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%94%E3%80%81-euraka%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3" target="_blank" rel="noopener noreferrer">#</a>五、 Euraka配置详解</span></a></h3><p>Eureka包含四个部分的配置</p><ul><li>instance：当前Eureka Instance实例信息配置</li><li>client：Eureka Client客户端特性配置</li><li>server：Eureka Server注册中心特性配置</li><li>dashboard：Eureka Server注册中心仪表盘配置</li></ul><h4 id="_1、实例信息配置" tabindex="-1"><a class="header-anchor" href="#_1、实例信息配置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81%E5%AE%9E%E4%BE%8B%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>1、实例信息配置</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">        <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token comment"># 是否将自己的ip注册到eureka中，默认false 注册 主机名</span></span>
<span class="line">        <span class="token key atrule">ip-address</span><span class="token punctuation">:</span> <span class="token comment"># 设置当前实例ip</span></span>
<span class="line">        <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> <span class="token comment"># 修改instance-id显示</span></span>
<span class="line">        <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> <span class="token number">30</span> <span class="token comment"># 每一次eureka client 向 eureka server发送心跳的时间间隔</span></span>
<span class="line">        <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">90</span> <span class="token comment"># 如果90秒内eureka server没有收到eureka client的心跳包，则剔除该服务</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>Eureka Instance的配置信息全部保存在org.springframework.cloud.netflix.eureka.EurekaInstanceConfigBean配置类里，实际上它是com.netflix.appinfo.EurekaInstanceConfig的实现类，替代了netflix的com.netflix.appinfo.CloudInstanceConfig的默认实现。</p><p>Eureka Instance的配置信息全部以eureka.instance.xxx的格式配置。</p><p><strong>配置列表</strong></p><ul><li>appname = unknown</li></ul><p>应用名，首先获取spring.application.name的值，如果取值为空，则取默认unknown。</p><ul><li>appGroupName = null</li></ul><p>应用组名</p><ul><li>instanceEnabledOnit = false</li></ul><p>实例注册到Eureka上是，是否立刻开启通讯。有时候应用在准备好服务之前需要一些预处理。</p><ul><li>nonSecurePort = 80</li></ul><p>非安全的端口</p><ul><li>securePort = 443</li></ul><p>安全端口</p><ul><li>nonSecurePortEnabled = true</li></ul><p>是否开启非安全端口通讯</p><ul><li>securePortEnabled = false</li></ul><p>是否开启安全端口通讯</p><ul><li>leaseRenewalIntervalInSeconds = 30</li></ul><p>实例续约间隔时间</p><ul><li>leaseExpirationDurationInSeconds = 90</li></ul><p>实例超时时间，表示最大leaseExpirationDurationInSeconds秒后没有续约，Server就认为他不可用了，随之就会将其剔除。</p><ul><li>virtualHostName = unknown</li></ul><p>虚拟主机名，首先获取spring.application.name的值，如果取值为空，则取默认unknown。</p><ul><li>instanceId</li></ul><p>注册到eureka上的唯一实例ID，不能与相同appname的其他实例重复。</p><ul><li>secureVirtualHostName = unknown</li></ul><p>安全虚拟主机名，首先获取spring.application.name的值，如果取值为空，则取默认unknown。</p><ul><li>metadataMap = new HashMap();</li></ul><p>实例元数据，可以供其他实例使用。比如spring-boot-admin在监控时，获取实例的上下文和端口。</p><ul><li>dataCenterInfo = new MyDataCenterInfo(DataCenterInfo.Name.MyOwn);</li></ul><p>实例部署的数据中心。如AWS、MyOwn。</p><ul><li>ipAddress=null</li></ul><p>实例的IP地址</p><ul><li>statusPageUrlPath = &quot;/actuator/info&quot;</li></ul><p>实例状态页相对url</p><ul><li>statusPageUrl = null</li></ul><p>实例状态页绝对URL</p><ul><li>homePageUrlPath = &quot;/&quot;</li></ul><p>实例主页相对URL</p><ul><li>homePageUrl = null</li></ul><p>实例主页绝对URL</p><ul><li>healthCheckUrlUrlPath = &quot;/actuator/health&quot;</li></ul><p>实例健康检查相对URL</p><ul><li>healthCheckUrl = null</li></ul><p>实例健康检查绝对URL</p><ul><li>secureHealthCheckUrl = null</li></ul><p>实例安全的健康检查绝对URL</p><ul><li>namespace = &quot;eureka&quot;</li></ul><p>配置属性的命名空间（Spring Cloud中被忽略）</p><ul><li>hostname = null</li></ul><p>主机名,不配置的时候讲根据操作系统的主机名来获取</p><ul><li>preferIpAddress = false</li></ul><p>是否优先使用IP地址作为主机名的标识</p><h4 id="_2、客户端特性配置" tabindex="-1"><a class="header-anchor" href="#_2、客户端特性配置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%89%B9%E6%80%A7%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>2、客户端特性配置</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">       		 <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line">        	<span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> </span>
<span class="line">        <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token comment"># 是否将自己的路径 注册到eureka上。</span></span>
<span class="line">        <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token comment"># 是否需要从eureka中抓取数据。</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7</p><p>Eureka Client客户端特性配置是对作为Eureka客户端的特性配置，包括Eureka注册中心，本身也是一个Eureka Client。</p><p>Eureka Client特性配置全部在org.springframework.cloud.netflix.eureka.EurekaClientConfigBean中，实际上它是com.netflix.discovery.EurekaClientConfig的实现类，替代了netxflix的默认实现。</p><p>Eureka Client客户端特性配置全部以eureka.client.xxx的格式配置。</p><p><strong>配置列表</strong></p><ul><li>enabled=true</li></ul><p>是否启用Eureka client。</p><ul><li>registryFetchIntervalSeconds=30</li></ul><p>定时从Eureka Server拉取服务注册信息的间隔时间</p><ul><li>instanceInfoReplicationIntervalSeconds=30</li></ul><p>定时将实例信息（如果变化了）复制到Eureka Server的间隔时间。（InstanceInfoReplicator线程）</p><ul><li>initialInstanceInfoReplicationIntervalSeconds=40</li></ul><p>首次将实例信息复制到Eureka Server的延迟时间。（InstanceInfoReplicator线程）</p><ul><li>eurekaServiceUrlPollIntervalSeconds=300</li></ul><p>拉取Eureka Server地址的间隔时间（Eureka Server有可能增减）</p><ul><li>proxyPort=null</li></ul><p>Eureka Server的代理端口</p><ul><li>proxyHost=null</li></ul><p>Eureka Server的代理主机名</p><ul><li>proxyUserName=null</li></ul><p>Eureka Server的代理用户名</p><ul><li>proxyPassword=null</li></ul><p>Eureka Server的代理密码</p><ul><li>eurekaServerReadTimeoutSeconds=8</li></ul><p>从Eureka Server读取信息的超时时间</p><ul><li>eurekaServerConnectTimeoutSeconds=5</li></ul><p>连接Eureka Server的超时时间</p><ul><li>backupRegistryImpl=null</li></ul><p>Eureka Client第一次启动时获取服务注册信息的调用的回溯实现。Eureka Client启动时首次会检查有没有BackupRegistry的实现类，如果有实现类，则优先从这个实现类里获取服务注册信息。</p><ul><li>eurekaServerTotalConnections=200</li></ul><p>Eureka client连接Eureka Server的链接总数</p><ul><li>eurekaServerTotalConnectionsPerHost=50</li></ul><p>Eureka client连接单台Eureka Server的链接总数</p><ul><li>eurekaServerURLContext=null</li></ul><p>当Eureka server的列表在DNS中时，Eureka Server的上下文路径。如http://xxxx/eureka。</p><ul><li>eurekaServerPort=null</li></ul><p>当Eureka server的列表在DNS中时，Eureka Server的端口。</p><ul><li>eurekaServerDNSName=null</li></ul><p>当Eureka server的列表在DNS中时，且要通过DNSName获取Eureka Server列表时，DNS名字。</p><ul><li>region=&quot;us-east-1&quot;</li></ul><p>实例所属区域。</p><ul><li>eurekaConnectionIdleTimeoutSeconds = 30</li></ul><p>Eureka Client和Eureka Server之间的Http连接的空闲超时时间。</p><ul><li>heartbeatExecutorThreadPoolSize=2</li></ul><p>心跳（续约）执行器线程池大小。</p><ul><li>heartbeatExecutorExponentialBackOffBound=10</li></ul><p>心跳执行器在续约过程中超时后的再次执行续约的最大延迟倍数。默认最大延迟时间=10 * eureka.instance.leaseRenewalIntervalInSeconds</p><ul><li>cacheRefreshExecutorThreadPoolSize=2</li></ul><p>cacheRefreshExecutord的线程池大小（获取注册信息）</p><ul><li>cacheRefreshExecutorExponentialBackOffBound=10</li></ul><p>cacheRefreshExecutord的再次执行的最大延迟倍数。默认最大延迟时间=10 *eureka.client.registryFetchIntervalSeconds</p><ul><li>serviceUrl= new HashMap();serviceUrl.put(DEFAULT_ZONE, DEFAULT_URL);</li></ul><p>Eureka Server的分区地址。默认添加了一个defualtZone。也就是最常用的配置eureka.client.service-url.defaultZone=xxx</p><ul><li>registerWithEureka=true</li></ul><p>是否注册到Eureka Server。</p><ul><li>preferSameZoneEureka=true</li></ul><p>是否使用相同Zone下的Eureka server。</p><ul><li>logDeltaDiff=false</li></ul><p>是否记录Eureka Server和Eureka Client之间注册信息的差异</p><ul><li>disableDelta=false</li></ul><p>是否开启增量同步注册信息。</p><ul><li>fetchRemoteRegionsRegistry=null</li></ul><p>获取注册服务的远程地区，以逗号隔开。</p><ul><li>availabilityZones=new HashMap()</li></ul><p>可用分区列表。用逗号隔开。</p><ul><li>filterOnlyUpInstances = true</li></ul><p>是否只拉取UP状态的实例。</p><ul><li>fetchRegistry=true</li></ul><p>是否拉取注册信息。</p><ul><li>shouldUnregisterOnShutdown = true</li></ul><p>是否在停止服务的时候向Eureka Server发起Cancel指令。</p><ul><li>shouldEnforceRegistrationAtInit = false</li></ul><p>是否在初始化过程中注册服务。</p><h4 id="_3、注册中心端配置" tabindex="-1"><a class="header-anchor" href="#_3、注册中心端配置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_3%E3%80%81%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%AB%AF%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>3、注册中心端配置</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">server</span><span class="token punctuation">:</span> <span class="token comment">#是否开启自我保护机制，默认true</span></span>
<span class="line">        <span class="token key atrule">enable-self-preservation</span><span class="token punctuation">:</span> </span>
<span class="line">        <span class="token key atrule">eviction-interval-timer-in-ms</span><span class="token punctuation">:</span> 120 2月<span class="token comment">#清理间隔（单位毫秒，默认是60*1000）</span></span>
<span class="line">	<span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> <span class="token number">30</span> <span class="token comment"># 每一次eureka client 向 eureka server发送心跳的时间间隔</span></span>
<span class="line">        <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">90</span> <span class="token comment"># 如果90秒内eureka server没有收到eureka client的心跳包，则剔除该服务        </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7</p><p>Eureka Server注册中心端的配置是对注册中心的特性配置。Eureka Server的配置全部在org.springframework.cloud.netflix.eureka.server.EurekaServerConfigBean里，实际上它是com.netflix.eureka.EurekaServerConfig的实现类，替代了netflix的默认实现。</p><p>Eureka Server的配置全部以eureka.server.xxx的格式进行配置。</p><p><strong>配置列表</strong></p><ul><li>enableSelfPreservation=true</li></ul><p>是否开启自我保护</p><ul><li>renewalPercentThreshold = 0.85</li></ul><p>自我保护续约百分比阀值因子。如果实际续约数小于续约数阀值，则开启自我保护</p><ul><li>renewalThresholdUpdateIntervalMs = 15 * 60 * 1000</li></ul><p>续约数阀值更新频率。</p><ul><li>peerEurekaNodesUpdateIntervalMs = 10 * 60 * 1000</li></ul><p>Eureka Server节点更新频率。</p><ul><li>enableReplicatedRequestCompression = false</li></ul><p>是否启用复制请求压缩。</p><ul><li>waitTimeInMsWhenSyncEmpty=5 * 60 * 1000</li></ul><p>当从其他节点同步实例信息为空时等待的时间。</p><ul><li>peerNodeConnectTimeoutMs=200</li></ul><p>节点间连接的超时时间。</p><ul><li>peerNodeReadTimeoutMs=200</li></ul><p>节点间读取信息的超时时间。</p><ul><li>peerNodeTotalConnections=1000</li></ul><p>节点间连接总数。</p><ul><li>peerNodeTotalConnectionsPerHost = 500;</li></ul><p>单个节点间连接总数。</p><ul><li>peerNodeConnectionIdleTimeoutSeconds = 30;</li></ul><p>节点间连接空闲超时时间。</p><ul><li>retentionTimeInMSInDeltaQueue = 3 * MINUTES;</li></ul><p>增量队列的缓存时间。</p><ul><li>deltaRetentionTimerIntervalInMs = 30 * 1000;</li></ul><p>清理增量队列中过期的频率。</p><ul><li>evictionIntervalTimerInMs = 60 * 1000;</li></ul><p>剔除任务频率。</p><ul><li>responseCacheAutoExpirationInSeconds = 180;</li></ul><p>注册列表缓存超时时间（当注册列表没有变化时）</p><ul><li>responseCacheUpdateIntervalMs = 30 * 1000;</li></ul><p>注册列表缓存更新频率。</p><ul><li>useReadOnlyResponseCache = true;</li></ul><p>是否开启注册列表的二级缓存。</p><ul><li>disableDelta=false。</li></ul><p>是否为client提供增量信息。</p><ul><li>maxThreadsForStatusReplication = 1;</li></ul><p>状态同步的最大线程数。</p><ul><li>maxElementsInStatusReplicationPool = 10000;</li></ul><p>状态同步队列的最大容量。</p><ul><li>syncWhenTimestampDiffers = true;</li></ul><p>当时间差异时是否同步。</p><ul><li>registrySyncRetries = 0;</li></ul><p>注册信息同步重试次数。</p><ul><li>registrySyncRetryWaitMs = 30 * 1000;</li></ul><p>注册信息同步重试期间的时间间隔。</p><ul><li>maxElementsInPeerReplicationPool = 10000;</li></ul><p>节点间同步事件的最大容量。</p><ul><li>minThreadsForPeerReplication = 5;</li></ul><p>节点间同步的最小线程数。</p><ul><li>maxThreadsForPeerReplication = 20;</li></ul><p>节点间同步的最大线程数。</p><ul><li>maxTimeForReplication = 30000;</li></ul><p>节点间同步的最大时间，单位为毫秒。</p><ul><li>disableDeltaForRemoteRegions = false；</li></ul><p>是否启用远程区域增量。</p><ul><li>remoteRegionConnectTimeoutMs = 1000;</li></ul><p>远程区域连接超时时间。</p><ul><li>remoteRegionReadTimeoutMs = 1000;</li></ul><p>远程区域读取超时时间。</p><ul><li>remoteRegionTotalConnections = 1000;</li></ul><p>远程区域最大连接数</p><ul><li>remoteRegionTotalConnectionsPerHost = 500;</li></ul><p>远程区域单机连接数</p><ul><li>remoteRegionConnectionIdleTimeoutSeconds = 30;</li></ul><p>远程区域连接空闲超时时间。</p><ul><li>remoteRegionRegistryFetchInterval = 30;</li></ul><p>远程区域注册信息拉取频率。</p><ul><li>remoteRegionFetchThreadPoolSize = 20;</li></ul><p>远程区域注册信息线程数。</p><h4 id="_4、仪表盘配置" tabindex="-1"><a class="header-anchor" href="#_4、仪表盘配置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_4%E3%80%81%E4%BB%AA%E8%A1%A8%E7%9B%98%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>4、仪表盘配置</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">dashboard</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否启用eureka web控制台</span></span>
<span class="line">        <span class="token key atrule">path</span><span class="token punctuation">:</span> / <span class="token comment"># 设置eureka web控制台默认访问路径</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><p>注册中心仪表盘的配置主要是控制注册中心的可视化展示。以eureka.dashboard.xxx的格式配置。</p><ul><li>path=&quot;/&quot;</li></ul><p>仪表盘访问路径</p><ul><li>enabled=true</li></ul><p>是否启用仪表盘</p><p><strong>改造 provider</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 将当前实例的ip注册到eureka server 中。默认是false 注册主机名</span></span>
<span class="line">    <span class="token key atrule">ip-address</span><span class="token punctuation">:</span> 127.0.0.1 <span class="token comment"># 设置当前实例的ip</span></span>
<span class="line">    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>eureka.instance.ip<span class="token punctuation">-</span>address<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span> <span class="token comment"># 设置web控制台显示的 实例id</span></span>
<span class="line">    <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment"># 每隔3 秒发一次心跳包</span></span>
<span class="line">    <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">9</span> <span class="token comment"># 如果9秒没有发心跳包，服务器呀，你把我干掉吧~</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>provider <span class="token comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18</p><p><strong>consumer</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>consumer <span class="token comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14</p><p><strong>server</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8761</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># eureka 配置</span></span>
<span class="line"><span class="token comment"># eureka 一共有4部分 配置</span></span>
<span class="line"><span class="token comment"># 1. dashboard:eureka的web控制台配置</span></span>
<span class="line"><span class="token comment"># 2. server:eureka的服务端配置</span></span>
<span class="line"><span class="token comment"># 3. client:eureka的客户端配置</span></span>
<span class="line"><span class="token comment"># 4. instance:eureka的实例配置</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>eureka.instance.hostname<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>/eureka <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line">    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否将自己的路径 注册到eureka上。eureka server 不需要的，eureka provider client 需要</span></span>
<span class="line">    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否需要从eureka中抓取路径。eureka server 不需要的，eureka consumer client 需要</span></span>
<span class="line">  <span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">enable-self-preservation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 关闭自我保护机制</span></span>
<span class="line">    <span class="token key atrule">eviction-interval-timer-in-ms</span><span class="token punctuation">:</span> <span class="token number">3000</span> <span class="token comment"># 检查服务的时间间隔</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22</p><h3 id="六、高可用" tabindex="-1"><a class="header-anchor" href="#六、高可用"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E5%85%AD%E3%80%81%E9%AB%98%E5%8F%AF%E7%94%A8" target="_blank" rel="noopener noreferrer">#</a>六、高可用</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220406114821846.5d110f1f.png" alt="image-20220406114821846"></p><ol><li>准备两个Eureka Server</li><li>分别进行配置，<strong>相互注册</strong></li><li>Eureka Client 分别注册到这两个 Eureka Server中</li></ol><p><strong>创建eureka-server1</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8761</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>server1 <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>server2<span class="token punctuation">:</span>8762/eureka</span>
<span class="line">    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否将自己的路径 注册到eureka上。eureka server 不需要的，eureka provider client 需要</span></span>
<span class="line">    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否需要从eureka中抓取路径。eureka server 不需要的，eureka consumer client 需要</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>server<span class="token punctuation">-</span>ha</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17</p><p><strong>创建eureka-server2</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8762</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>server2 <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>server1<span class="token punctuation">:</span>8761/eureka</span>
<span class="line"></span>
<span class="line">    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否将自己的路径 注册到eureka上。eureka server 不需要的，eureka provider client 需要</span></span>
<span class="line">    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否需要从eureka中抓取路径。eureka server 不需要的，eureka consumer client 需要</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>server<span class="token punctuation">-</span>ha</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16</p><p><strong>修改</strong>：C:\Windows\System32\drivers\etc\hosts</p><p>127.0.0.1 eureka-server1 127.0.0.1 eureka-server2</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220406144138369.3a3af0a9.png" alt="image-20220406144138369"></p><p>测试：</p><p>provider</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 将当前实例的ip注册到eureka server 中。默认是false 注册主机名</span></span>
<span class="line">    <span class="token key atrule">ip-address</span><span class="token punctuation">:</span> 127.0.0.1 <span class="token comment"># 设置当前实例的ip</span></span>
<span class="line">    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>eureka.instance.ip<span class="token punctuation">-</span>address<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span> <span class="token comment"># 设置web控制台显示的 实例id</span></span>
<span class="line">    <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment"># 每隔3 秒发一次心跳包</span></span>
<span class="line">    <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">9</span> <span class="token comment"># 如果9秒没有发心跳包，服务器呀，你把我干掉吧~</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>server1<span class="token punctuation">:</span>8761/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>server2<span class="token punctuation">:</span>8762/eureka <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>provider <span class="token comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19</p><p>consumer</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span>  http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>server1<span class="token punctuation">:</span>8761/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka<span class="token punctuation">-</span>server2<span class="token punctuation">:</span>8762/eureka  <span class="token comment"># eureka服务端地址，将来客户端使用该地址和eureka进行通信</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> eureka<span class="token punctuation">-</span>consumer <span class="token comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14</p><p>访问：http://localhost:9000/order/add/4</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220406144153992.acdf6713.png" alt="image-20220406144153992"></p><p>高可用测试：停掉一个eureka,依然可以访问consumer。</p><p>eureka不更新了，所以淘汰了。</p><h2 id="第六章-zookeeper服务注册与发现" tabindex="-1"><a class="header-anchor" href="#第六章-zookeeper服务注册与发现"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%85%AD%E7%AB%A0-zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0" target="_blank" rel="noopener noreferrer">#</a>第六章 Zookeeper服务注册与发现</span></a></h2><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220406194741473.cc3720e9.png" alt="image-20220406194741473"></p><p>有的老项目以前是dubbo，升级到微服务，使用zookeeper做注册中心。</p><p>zookeeper是一个分布式协调工具，可以实现注册中心功能。dubbo,大数据组件hadoop,hive,kafka。</p><p><strong>实质</strong>：注册中心换成zk</p><p>1下载：https://zookeeper.apache.org/</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220406152809933.e8b336fb.png" alt="image-20220406152809933"></p><p>zoo.cfg</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># The number of milliseconds of each tick</span>
<span class="line">tickTime=2000</span>
<span class="line"># The number of ticks that the initial </span>
<span class="line"># synchronization phase can take</span>
<span class="line">initLimit=10</span>
<span class="line"># The number of ticks that can pass between </span>
<span class="line"># sending a request and getting an acknowledgement</span>
<span class="line">syncLimit=5</span>
<span class="line"># the directory where the snapshot is stored.</span>
<span class="line"># do not use /tmp for storage, /tmp here is just </span>
<span class="line"># example sakes.</span>
<span class="line">dataDir=F:/apache-zookeeper-3.5.6-bin/data</span>
<span class="line"># the port at which the clients will connect</span>
<span class="line">clientPort=2181</span>
<span class="line"># the maximum number of client connections.</span>
<span class="line"># increase this if you need to handle more clients</span>
<span class="line">#maxClientCnxns=60</span>
<span class="line">#</span>
<span class="line"># Be sure to read the maintenance section of the </span>
<span class="line"># administrator guide before turning on autopurge.</span>
<span class="line">#</span>
<span class="line"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span>
<span class="line">#</span>
<span class="line"># The number of snapshots to retain in dataDir</span>
<span class="line">#autopurge.snapRetainCount=3</span>
<span class="line"># Purge task interval in hours</span>
<span class="line"># Set to &quot;0&quot; to disable auto purge feature</span>
<span class="line">#autopurge.purgeInterval=1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28</p><p>启动 bin目录下</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">zkServer.cmd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220406153622431.66776d12.png" alt="image-20220406153622431"></p><p>2zookeeper-provider</p><p>pom</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">&lt;artifactId&gt;zookeeper-provider&lt;/artifactId&gt;</span>
<span class="line"></span>
<span class="line">&lt;dependencies&gt;</span>
<span class="line">    &lt;!--springcloud 整合 zookeeper 组件--&gt;</span>
<span class="line">    &lt;dependency&gt;</span>
<span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="line">        &lt;!--zk发现--&gt;</span>
<span class="line">        &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt;</span>
<span class="line">        &lt;exclusions&gt;</span>
<span class="line">            &lt;exclusion&gt;</span>
<span class="line">                &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span>
<span class="line">                &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span>
<span class="line">            &lt;/exclusion&gt;</span>
<span class="line">        &lt;/exclusions&gt;</span>
<span class="line">    &lt;/dependency&gt;</span>
<span class="line">    &lt;dependency&gt;</span>
<span class="line">        &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span>
<span class="line">        &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span>
<span class="line">        &lt;version&gt;3.4.9&lt;/version&gt;</span>
<span class="line">        &lt;exclusions&gt;</span>
<span class="line">            &lt;exclusion&gt;</span>
<span class="line">                &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span>
<span class="line">                &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span>
<span class="line">            &lt;/exclusion&gt;</span>
<span class="line">        &lt;/exclusions&gt;</span>
<span class="line">    &lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line">    &lt;dependency&gt;</span>
<span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span>
<span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span>
<span class="line">    &lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line">&lt;/dependencies&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34</p><p>yml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">server:</span>
<span class="line">  port: 8004</span>
<span class="line"></span>
<span class="line">spring:</span>
<span class="line">  application:</span>
<span class="line">    name: zookeeper-provider</span>
<span class="line">  cloud:</span>
<span class="line">    zookeeper:</span>
<span class="line">      connect-string: 127.0.0.1:2181 # zk地址</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9</p><p>主启动类</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">package com.ydlclass.zk;</span>
<span class="line"></span>
<span class="line">import org.springframework.boot.SpringApplication;</span>
<span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span>
<span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span>
<span class="line"></span>
<span class="line">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span>
<span class="line">@SpringBootApplication</span>
<span class="line">@EnableDiscoveryClient //开启发现客户端</span>
<span class="line">public class ProviderApp {</span>
<span class="line">    public static void main(String[] args) {</span>
<span class="line">        SpringApplication.run(ProviderApp.class,args);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19</p><p>业务逻辑代码直接复制粘贴过来</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220406172259585.d9bdd516.png" alt="image-20220406172259585"></p><p>3zookeeper-consumer</p><p>pom</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">   &lt;artifactId&gt;zookeeper-consumer&lt;/artifactId&gt;</span>
<span class="line"></span>
<span class="line">    &lt;properties&gt;</span>
<span class="line">        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span>
<span class="line">        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span>
<span class="line">    &lt;/properties&gt;</span>
<span class="line"></span>
<span class="line">    &lt;dependencies&gt;</span>
<span class="line">        &lt;!--springcloud 整合 zookeeper 组件--&gt;</span>
<span class="line">        &lt;dependency&gt;</span>
<span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="line">            &lt;!--zk发现--&gt;</span>
<span class="line">            &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt;</span>
<span class="line">            &lt;exclusions&gt;</span>
<span class="line">                &lt;exclusion&gt;</span>
<span class="line">                    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span>
<span class="line">                    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span>
<span class="line">                &lt;/exclusion&gt;</span>
<span class="line">            &lt;/exclusions&gt;</span>
<span class="line">        &lt;/dependency&gt;</span>
<span class="line">        &lt;dependency&gt;</span>
<span class="line">            &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;</span>
<span class="line">            &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;</span>
<span class="line">            &lt;version&gt;3.5.6&lt;/version&gt;</span>
<span class="line">            &lt;exclusions&gt;</span>
<span class="line">                &lt;exclusion&gt;</span>
<span class="line">                    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span>
<span class="line">                    &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span>
<span class="line">                &lt;/exclusion&gt;</span>
<span class="line">            &lt;/exclusions&gt;</span>
<span class="line">        &lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line">        &lt;dependency&gt;</span>
<span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span>
<span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span>
<span class="line">        &lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line">    &lt;/dependencies&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38</p><p>yml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">server:</span>
<span class="line">  port: 8005</span>
<span class="line"></span>
<span class="line">spring:</span>
<span class="line">  application:</span>
<span class="line">    name: zookeeper-consumer</span>
<span class="line">  cloud:</span>
<span class="line">    zookeeper:</span>
<span class="line">      connect-string: 127.0.0.1:2181 # zk地址</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9</p><p>启动类</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">package com.ydlclass.zk;</span>
<span class="line"></span>
<span class="line">import org.springframework.boot.SpringApplication;</span>
<span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span>
<span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span>
<span class="line"></span>
<span class="line">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span>
<span class="line">@SpringBootApplication</span>
<span class="line">@EnableDiscoveryClient</span>
<span class="line">public class ConsumerApp {</span>
<span class="line">    public static void main(String[] args) {</span>
<span class="line">        SpringApplication.run(ConsumerApp.class,args);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18</p><p>业务逻辑代码直接复制粘贴过来</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220406185656845.d3703bb1.png" alt="image-20220406185656845"></p><p>controller只改一个</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&quot;zookeeper-provider&quot;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p>测试：http://localhost:8005/order/add/5</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407144912417.fd30484b.png" alt="image-20220407144912417"></p><h2 id="第七章-consul服务注册与发现" tabindex="-1"><a class="header-anchor" href="#第七章-consul服务注册与发现"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E4%B8%83%E7%AB%A0-consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0" target="_blank" rel="noopener noreferrer">#</a>第七章 Consul服务注册与发现</span></a></h2><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407161804433.7424151c.png" alt="image-20220407161804433"></p><h3 id="一、-是什么" tabindex="-1"><a class="header-anchor" href="#一、-是什么"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81-%E6%98%AF%E4%BB%80%E4%B9%88" target="_blank" rel="noopener noreferrer">#</a>一、 是什么：</span></a></h3><ul><li>Consul 是由 HashiCorp 基于 GoLanguage 语言开发的，支持多数据中心，分布式高可用的服务发布和注册服务软件。</li><li>用于实现分布式系统的服务发现与配置。</li><li>使用起来也较 为简单。具有天然可移植性(支持Linux、windows和Mac OS X)；安装包仅包含一个可执行文件，方便部署 。</li><li>Consul官网：https://www.consul.io/ Consul中文文档：https://www.springcloud.cc/spring-cloud-consul.html</li></ul><h3 id="二、-怎么用" tabindex="-1"><a class="header-anchor" href="#二、-怎么用"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81-%E6%80%8E%E4%B9%88%E7%94%A8" target="_blank" rel="noopener noreferrer">#</a>二、 怎么用：</span></a></h3><h4 id="_1、-准备" tabindex="-1"><a class="header-anchor" href="#_1、-准备"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81-%E5%87%86%E5%A4%87" target="_blank" rel="noopener noreferrer">#</a>1、 准备</span></a></h4><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407161630689.ac7c0b2d.png" alt="image-20220407161630689"></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">consul.exe agent -dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407161746354.b746e58c.png" alt="image-20220407161746354"></p><h4 id="_2、-搭建-consul-provider" tabindex="-1"><a class="header-anchor" href="#_2、-搭建-consul-provider"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81-%E6%90%AD%E5%BB%BA-consul-provider" target="_blank" rel="noopener noreferrer">#</a>2、 搭建 consul-provider</span></a></h4><p>pom</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">    &lt;dependencies&gt;</span>
<span class="line">        &lt;dependency&gt;</span>
<span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="line">            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;</span>
<span class="line">        &lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line">        &lt;dependency&gt;</span>
<span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span>
<span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span>
<span class="line">        &lt;/dependency&gt;</span>
<span class="line"></span>
<span class="line">    &lt;/dependencies&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12</p><p>yml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">server:</span>
<span class="line">  port: 8006</span>
<span class="line"></span>
<span class="line">spring:</span>
<span class="line">  application:</span>
<span class="line">    name: consul-provider</span>
<span class="line">  cloud:</span>
<span class="line">    consul:</span>
<span class="line">      host: 127.0.0.1</span>
<span class="line">      port: 8500</span>
<span class="line">      discovery:</span>
<span class="line">        service-name: ${spring.application.name}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12</p><p>启动类</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">package com.ydlclass.consul;</span>
<span class="line"></span>
<span class="line">import org.springframework.boot.SpringApplication;</span>
<span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span>
<span class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span>
<span class="line"></span>
<span class="line">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span>
<span class="line">@SpringBootApplication</span>
<span class="line">@EnableDiscoveryClient</span>
<span class="line">public class ProviderApp {</span>
<span class="line">    public static void main(String[] args) {</span>
<span class="line">        SpringApplication.run(ProviderApp.class,args);</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19</p><p>业务逻辑复制</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407163424691.9008997e.png" alt="image-20220407163424691"></p><p>启动</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407162423209.689703ea.png" alt="image-20220407162423209"></p><h4 id="_3、搭建-consul-consumer" tabindex="-1"><a class="header-anchor" href="#_3、搭建-consul-consumer"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_3%E3%80%81%E6%90%AD%E5%BB%BA-consul-consumer" target="_blank" rel="noopener noreferrer">#</a>3、搭建 consul-consumer</span></a></h4><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11</p><p>yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8007</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> consul<span class="token punctuation">-</span>consumer</span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">consul</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1</span>
<span class="line">      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span></span>
<span class="line">      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12</p><p>启动类</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consul</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token annotation punctuation">@EnableDiscoveryClient</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerApp</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConsumerApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19</p><p>业务逻辑复制</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407164001822.47a4a47b.png" alt="image-20220407164001822"></p><p>controller只改一句话</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">&quot;consul-provider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p>启动</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407164133404.c379b922.png" alt="image-20220407164133404"></p><p>最终测试调用成功即可：http://localhost:8007/order/add/9</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAY4AAAC6CAMAAACORlpBAAAAflBMVEX///8jIyMxMTE6OjotLS0aGhomJiggISQRERENDQ0zMzNAQEAAAAAfHx8HBweKjYf//twaAdRGREULdQDN//7c3NyRAcyKck1siJB+SS4gOns/ISQ8b5O4urueoqZmaGkgIU3D7v+XISRBtOMgNmVERI/yyotiNiTTnSQgIawFNpvTAAALc0lEQVR42u1dC0OjOhMlXsJjvyJulY9WW1DXte7//4N3ZsIjPAttVfb2HFoIZEhrTk5mEig6AbAgOP8DFgTnB7AgODfAguC4wIIAOkDHMXieUv5VwnG9pS2ef71wvKXB90HHYqD8K6dDLWm5cjZ8Ry0KPuj4euwzD3RMpsNNktHa9PLcG869iRPHSbIb5WUDp2eOkx0nw8vjLIvz63Ltjh+p1uImTqI7R61F5XHuDmXmjsFdvieq+ywyJ0kc0kcnJ7L5WGdZTsiytUXI48t7NPSX/Lp7HcsuON7EcfxERjveqnL7FjOy1BWTbU8TeN5su0XvUlf12RQJLumRyt3OoCNqwyM2vGgMyiU++k08YiNbR9E6Y0r6LPTeSVxiPOsWa/293jrb3HDiZpOtG3QM/SGBoaM3T1OeJNQudr1N6utd/ORv0qdySx/ouVSJbPJIhzpQJrNDUa+Nqkt6iw/uY3w4nQ7WRqSjcbA+VF+G6zjUkbHFfoAO0oaST8m6BdRfy81iWmcZreLsfHVQnoTQVE/ap1qS5ktVVW6Ltn5jNn3Rdp86qCA1pg4qiQujlVaT6dCNRREbSkfHlkj46B6PudVTQu9FHR0D7qk8zveSwtIutG7OeXZT0uFleXVYmr9+oaI/fJOget7R7rsfGjpeOF3b6F9kcuCdu1eqGuo+lPeYPhkGNiltlX4muVRtnVu2ohX3Yb73Fv/O2DqO15Qrh9PyKFez8jmPTy9t6gSXREpUfrRLnyarQzcgfkOPUlHzEXUzE2ctR6WvcrpnZxXZbpsPra2vtbFc+Caucv68vBMld69Uyx/Kf0le9e7jMTn4O6p6ouNPwlvnw6tsdg8fZMKdlY64Y3pLqbM6cDeiuP5pSw7L9DEkDtOkb8iVpFTZZPMYp6ye1Hc38TZ6i7ceN3w5yhV/oKjGJXY4q7IpEtQxpj/oTeUXspuoDl2/gsSxkOgO8jguX7R081kRTGfBWguKWapNnayZbX0towhRBymlUsfby3tAtUyF/7o7/EpYIs++Fpoq30ErLTaKbchpPItyJHSLHjN2re6buHNWB7Vbd5dajmDDTFBzjqJNSo74wLXpcd1vPbajpq7kaNXoI2aotKmMTUlsSgzFp6qjSUfQpSM3RAgfedRDhx5Dsrfp2CdT6PDzTFu+g1t64FNVv0qCyPjzwL2VNnR44l8oHYoN5b1r8R1PHLxR29Xc7KlhR0YdB81bZRyBafLaM70Xtex6T3qemMlMf8hZFDexRqRbSysbv0pISUpx5Jan3ml0BAG7jqDcCQbrNdTcWXUO0+lrOYlWah+3zqfdyKajfb71tWKmQxd0bGxX/rxPXk2stL87SERFHRQdZwX8KdRR23jsPD44j7sXbtrUp8dbVkVEnZSogzsrcQSKQ680MrVJNZmKimSPOqmD+BiPQjA5y0RgRf9l2ZjE1pRE0YqnNH/qVDoCqqVAVlxdQcSBVbGjdZ1ZrcwrylkbQWeJuQMyZhn5hkbhciLRUewxMc2irdAlz36IOoiiH7UrF99hqtaoQ5moKSpU88Z0NGwiUg/RI51VGTxRZd1IRLU5uFVkRRypqGjXpuvh1s86MHuP2Zaqlccl0gNpLksZt0CGurQpjMl3FJ2f4oIOM9Rhar6qM4pQydvaVdxaSUK0EfQsFOiaBA1A/gkahRf5tWW7fDuSzDZlZ7XJPNt3iCsPSRKB8dcftH765bwXkVXThrIL5XyIR+AGzi6da42aL1e8y9uirati0MH+mIckogNyIFvuk7aKXYLeiedREoGJEZW3VZUNJVSREAltfW+GOEQdDG3eVCs8DNTlAV3mlSvTkkkbutoJamMdyDAw0DwMzFvZpSYqdbTKb/RW6yw2w8C4NQzUJAUKWz8073FUK2vioRx3sI1f2kjmM28o0JWeR0bhKtpl1OPzlnt+6aRcauzc0MWDcET7FIk6mCOKXTlY4kAgDUQdigMx0hMbkowqmzIhJXGQG5swbDIdZa3r8tYr1od1oMUIg4Mq614t++zbcpLEyS0i6lMdp52yim4Oy8tJEvvrythEy0JbIpACq4g6a8+nP+JJP0WFjS5tuLfnpIR71JmrcrYtkkkyxVcfOUyKVOHIZaZGyaUXtoqKHa/oeMQy0hI3meLlC9U2vHVNFGx2/cifR0ejXglestej98rledg6pUaoeQpxH0ftDF2QUKNTrm5OIW6ybJMf+f6RtT4GqT8zj+YLF3ae6k5CGdbqU+ujyheF9BRvTWdFJ8xPOz21HQbjbAS34UhmGIYj+fuajaybG/lfgJFp/NbVSNVbozK5ptT4dz3xuqZz24fV7ThWo3mrE8+kzC/hY8kT7L3DimhwwGHG2tVkyaDF8Pnlup4csU+9djpuw56l92C1hLdHl7B495waNspof2xw3YQ44UxUdWmqtteirvmek2/DmpYeXDcfTljXz5RXo9aP2YydXhLSfQVQx7LQHBGCDqDROor3JKtgqn0vHDrxpCUIP3Uxq0BWgxbFq3z354Y9pbSygrAccHU+pDha7TTHZ0GzjM7Xn/13Owv9kVwYtKqq36JFSCM3tGy6pbSywv7PCe3v0OWq0WLsEka/+dhvA/HzyEX9VPMfYEFwAAAAAAAAAAAAAAAAAOAvxd12/fsB1bAYNkDGkuh4BR3fgKRCi44UdHwnH1DHoumA7/hWPhx0VguiA33VkuhAoLsoPhDoLoqPLh3wHd9HB4aBSx+VQx3L4uMVU4gAAAAA8NdijyoAHQAAdQAXx1peX3ce1AE2/mviWDFmnHf3/58/f2JuZq46prBheFg19o+z8cBvEPAJaNHhrI6eIVSAj8+JrEbpWK9BxycooHAOpY+wtzYdXScCOi6vjpX15lV7W9Kxmt5ZsTcHHaf3RxekQyKrPdRxsu+wu6QL0CEAHWd56wvTAd9xljqGOqtVi44JrlyoEDbWGLufE8v2RFaOvJr7x+hwKkcOOk6MrCb7hLmzMMBJ4w6w8VeMygEA6gAAqAMAAKgDaOO+tYU6jo3TZg3Vjtnf2zV/z6jpsHabdsAns3FvV31FR62S62Rj9n1WnamS1TniAB1niqNFR3smaxYbdbLQSk3HlbIxPbIaUsWJE4v3NXrVAVyWjinXlWyhgI4Z6rDu62nsN27oOY+Oe9Bxgjr6t6ddnrKdulmgju+g474J0HFpdaxOuVx43wq4oI5LquPkCZJWZAWBTKJj1aJh9P6qma58gI4ru+9nxoxudcf0qm//3Miqnj1pHsatDV+F+146nOZUFtTxhXwMkgNxAFeuDgCAOgAA6gCAK1PHpe9dAM4B2FiUOoaqd2g2fZwOeTKMPBymekZMNwHMb+wDdEx4NEyVqB690ExAHV+GBh0DnEADn6KrNej4LHWUv042P1Ne2be7zbreYXzHg/2MmG4CmMJHccWvdVWw+O3/vEfDPNTPiOkmoI4JdFhVbx3pPBxjugMpnxFz10kA59Mx406SukcaSUAdZ6tjIhNNf96fACb6jiYdw75jMLIyVV49I6abuOKnxkxXR/fGkdX8yMoaelduu5vALMukzuoLpwKgjvG+agU2AKgDAACoAwCgDgCAOq4CuJVkSeoAG/9tcZRz6N2ZQ+Ai//vJsW7zOWZv31XVmlcHTsFqxtFhdeAGkgtFVlPpGLqIBDouIopVeUNP63JT9Y8kpvzPJ9BxGXUM/tuU+uLsrBsX7nB71WU8RpOO+taFqd6jqHqo4yzf0Xp+VYeO1Tw6ynutQMeZEhlSx7x/wNW6aR10nOE7Vr2+w5n2TJJCCRh3XCCwqod8zciqupX6GB3F720eMCq/0LgDAKAOAIA6AAAAAAD4S3G3Xf/GcHhRhIAP0AEM0PEKOpZERwo6oA4A6oA8AERWEAcA3wF1AFDHFTlyTCECAAAAAAAAAAAAwGfgX2ekYuNyalvhAAAAAElFTkSuQmCC" alt="image-20220407164211124"></p><h3 id="三、-三个注册中心的异同" tabindex="-1"><a class="header-anchor" href="#三、-三个注册中心的异同"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81-%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E5%BC%82%E5%90%8C" target="_blank" rel="noopener noreferrer">#</a>三、 三个注册中心的异同</span></a></h3><table><thead><tr><th>组件</th><th>语言</th><th>cap</th><th>健康检查</th><th>暴露接口</th><th>cloud集成</th></tr></thead><tbody><tr><td>eureka</td><td>java</td><td>ap</td><td>支持</td><td>http</td><td>已经集成</td></tr><tr><td>zookeeper</td><td>java</td><td>cp</td><td>支持</td><td>tcp</td><td>已经集成</td></tr><tr><td>consul</td><td>go</td><td>cp</td><td>支持</td><td>http</td><td>已经集成</td></tr></tbody></table><p>cap</p><ul><li>c:consustency 强一致性</li><li>a:avalibility 可用性</li><li>p:partition tolerance 分区容忍性</li></ul><h2 id="第八章-ribbon负载均衡服务调用" tabindex="-1"><a class="header-anchor" href="#第八章-ribbon负载均衡服务调用"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%85%AB%E7%AB%A0-ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8" target="_blank" rel="noopener noreferrer">#</a>第八章 Ribbon负载均衡服务调用</span></a></h2><h3 id="一、是什么" tabindex="-1"><a class="header-anchor" href="#一、是什么"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81%E6%98%AF%E4%BB%80%E4%B9%88" target="_blank" rel="noopener noreferrer">#</a>一、是什么</span></a></h3><p>Netflix公司推出的http和TCP的客户端负载均衡工具。</p><p>ribbon:</p><ul><li>简化远程调用代码</li><li>内置很多负载均衡算法</li></ul><h4 id="_1、服务端负载均衡" tabindex="-1"><a class="header-anchor" href="#_1、服务端负载均衡"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" target="_blank" rel="noopener noreferrer">#</a>1、服务端负载均衡</span></a></h4><p>负载均衡算法在服务端，服务端维护服务列表。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407173053676.2349faf0.png" alt="image-20220407173053676"></p><h4 id="_2、客户端负载均衡" tabindex="-1"><a class="header-anchor" href="#_2、客户端负载均衡"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" target="_blank" rel="noopener noreferrer">#</a>2、客户端负载均衡</span></a></h4><ul><li>负载均衡算法在客户端</li><li>客户端维护服务列表</li></ul><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220407173409352.2bb522c4.png" alt="image-20220407173409352"></p><h3 id="二、如何使用" tabindex="-1"><a class="header-anchor" href="#二、如何使用"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8" target="_blank" rel="noopener noreferrer">#</a>二、如何使用</span></a></h3><p>1.新版的eureka依赖以及集成了Ribbon依赖，所以可以不引用</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">  &lt;!--Ribbon的依赖--&gt;</span>
<span class="line">  &lt;dependency&gt;</span>
<span class="line">      &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="line">      &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;</span>
<span class="line"> &lt;/dependency&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408112040713.49705355.png" alt="image-20220408112040713"></p><p>2.声明restTemplate时@LoadBalanced</p><p>3.restTemplate请求远程服务时，ip端口替换为服务名</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">String</span> url<span class="token operator">=</span><span class="token string">&quot;http://EUREKA-PROVIDER/goods/findById/&quot;</span><span class="token operator">+</span>id<span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">Goods</span> goods <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token class-name">Goods</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2</p><p>测试：</p><p>1.启动2个provider</p><p>controller</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">goods.setTitle(goods.getTitle()+&quot;|端口号：&quot;+port);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p>idea设置 能启动两份 provider</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408112658153.df840762.png" alt="image-20220408112658153"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408112814966.37a23e92.png" alt="image-20220408112814966"></p><p>2.多次访问consumer</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408113212684.cc4cce36.png" alt="image-20220408113212684"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408113134662.3d63cf60.png" alt="image-20220408113134662"></p><p>多次刷新，发现：ribbon客户端，默认使用轮询算法，经行负载均衡调用。</p><h3 id="三、ribbon-负载均衡策略" tabindex="-1"><a class="header-anchor" href="#三、ribbon-负载均衡策略"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81ribbon-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5" target="_blank" rel="noopener noreferrer">#</a>三、ribbon 负载均衡策略</span></a></h3><table><thead><tr><th><strong>内置负载均衡规则类</strong></th><th><strong>规则描述</strong></th></tr></thead><tbody><tr><td>RoundRobinRule</td><td>简单轮询服务列表来选择服务器。它是Ribbon默认的负载均衡规则。</td></tr><tr><td>AvailabilityFilteringRule</td><td>对以下两种服务器进行忽略：（1）在默认情况下，这台服务器如果3次连接失败，这台服务器就会被设置为“短路”状态。短路状态将持续30秒，如果再次连接失败，短路的持续时间就会几何级地增加。注意：可以通过修改配置loadbalancer.<code>&lt;clientName&gt;</code>.connectionFailureCountThreshold来修改连接失败多少次之后被设置为短路状态。默认是3次。（2）并发数过高的服务器。如果一个服务器的并发连接数过高，配置了AvailabilityFilteringRule规则的客户端也会将其忽略。并发连接数的上线，可以由客户端的<code>&lt;clientName&gt;</code>.<code>&lt;clientName&gt;</code>.ActiveConnectionsLimit属性进行配置。</td></tr><tr><td>WeightedResponseTimeRule</td><td>为每一个服务器赋予一个权重值。服务器响应时间越长，这个服务器的权重就越小。这个规则会随机选择服务器，这个权重值会影响服务器的选择。</td></tr><tr><td>ZoneAvoidanceRule</td><td>以区域可用的服务器为基础进行服务器的选择。使用Zone对服务器进行分类，这个Zone可以理解为一个机房、一个机架等。</td></tr><tr><td>BestAvailableRule</td><td>忽略哪些短路的服务器，并选择并发数较低的服务器。</td></tr><tr><td>RandomRule</td><td>随机选择一个可用的服务器。</td></tr><tr><td>Retry</td><td>重试机制的选择逻辑</td></tr></tbody></table><h3 id="四、-设置ribbon-负载均衡策略" tabindex="-1"><a class="header-anchor" href="#四、-设置ribbon-负载均衡策略"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E5%9B%9B%E3%80%81-%E8%AE%BE%E7%BD%AEribbon-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5" target="_blank" rel="noopener noreferrer">#</a>四、 设置ribbon 负载均衡策略</span></a></h3><h4 id="_1、代码" tabindex="-1"><a class="header-anchor" href="#_1、代码"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener noreferrer">#</a>1、代码</span></a></h4><p>consumer工程</p><p>1.MyRule 返回想要的规则即可</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span></span><span class="token class-name">IRule</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span></span><span class="token class-name">RandomRule</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * creste by ydlclass.itcast</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRule</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">IRule</span> <span class="token function">rule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17</p><p>2.启动类</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@RibbonClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span><span class="token string">&quot;EUREKA-PROVIDER&quot;</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">MyRule</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p>总结：</p><p>1.irule的具体实现类，看到他带的几个策略的写法。</p><p>2.仿照策略的写法，自己写策略。</p><p>3.调用不同的其他微服务时，可以采用不同的策略。</p><h4 id="_2、配置" tabindex="-1"><a class="header-anchor" href="#_2、配置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>2、配置</span></a></h4><p>consumer工程</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">EUREKA-PROVIDER</span><span class="token punctuation">:</span> <span class="token comment">#远程服务名</span></span>
<span class="line">  <span class="token key atrule">ribbon</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">NFLoadBalancerRuleClassName</span><span class="token punctuation">:</span> com.netflix.loadbalancer.RandomRule <span class="token comment">#策略</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3</p><p>作用：方便运维修改，重启。随时切换策略。</p><h2 id="第九章、openfeign服务接口调用" tabindex="-1"><a class="header-anchor" href="#第九章、openfeign服务接口调用"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E4%B9%9D%E7%AB%A0%E3%80%81openfeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8" target="_blank" rel="noopener noreferrer">#</a>第九章、OpenFeign服务接口调用</span></a></h2><h3 id="一、概述" tabindex="-1"><a class="header-anchor" href="#一、概述"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">#</a>一、概述</span></a></h3><ul><li>Feign 是一个声明式的 REST 客户端，它用了<strong>基于接口的注解方式</strong>，很方便实现客户端像调用本地接口方法一样，进行远程调用。</li><li>Feign 最初由 Netflix 公司提供，但不支持SpringMVC注解，后由 SpringCloud 对其封装，支持了SpringMVC注解，让使用者更易于接受。</li><li>https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign</li></ul><h3 id="二、快速入门" tabindex="-1"><a class="header-anchor" href="#二、快速入门"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8" target="_blank" rel="noopener noreferrer">#</a>二、快速入门</span></a></h3><p>a.在消费端引入 open-feign 依赖：</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><p>b.编写Feign调用接口。<strong>复制粘贴被调方的conreoller方法,加上类路径。</strong></p><p>GoodsFeignClient：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">&quot;EUREKA-PROVIDER&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GoodsFeign</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/goods/findById/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17</p><p>c.在启动类 添加 @EnableFeignClients 注解，开启Feign功能</p><p>d.测试调用</p><p>OrderController</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign<span class="token punctuation">.</span></span><span class="token class-name">GoodsFeign</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ServiceInstance</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">DiscoveryClient</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/order&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token class-name">GoodsFeign</span> goodsFeign<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//业务逻辑</span></span>
<span class="line">        <span class="token comment">//1查询商品</span></span>
<span class="line">        <span class="token comment">//2减库存</span></span>
<span class="line">        <span class="token comment">//3支付</span></span>
<span class="line">        <span class="token comment">//4物流</span></span>
<span class="line">        <span class="token comment">//直接调用</span></span>
<span class="line">        <span class="token comment">//String url=&quot;http://localhost:8000/goods/findById/&quot;+id;</span></span>
<span class="line">        <span class="token comment">//Goods goods = restTemplate.getForObject(url, Goods.class);</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//        //1服务发现</span></span>
<span class="line"><span class="token comment">//        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&quot;EUREKA-PROVIDER&quot;);</span></span>
<span class="line"><span class="token comment">//        if(instances==null||instances.size()&lt;=0){</span></span>
<span class="line"><span class="token comment">//            return null;</span></span>
<span class="line"><span class="token comment">//        }</span></span>
<span class="line"><span class="token comment">//        //2通过某个策略拿到一个实例 算法</span></span>
<span class="line"><span class="token comment">//        ServiceInstance serviceInstance = instances.get(0);</span></span>
<span class="line"><span class="token comment">//        String host = serviceInstance.getHost();</span></span>
<span class="line"><span class="token comment">//        int port = serviceInstance.getPort();</span></span>
<span class="line"><span class="token comment">//        System.out.println(host);</span></span>
<span class="line"><span class="token comment">//        System.out.println(port);</span></span>
<span class="line"><span class="token comment">//</span></span>
<span class="line"><span class="token comment">//        String url=&quot;http://&quot;+host+&quot;:&quot;+port+&quot;/goods/findById/&quot;+id;</span></span>
<span class="line"><span class="token comment">//        Goods goods = restTemplate.getForObject(url, Goods.class);</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//ribbon</span></span>
<span class="line"><span class="token comment">//        String url=&quot;http://EUREKA-PROVIDER/goods/findById/&quot;+id;</span></span>
<span class="line"><span class="token comment">//        Goods goods = restTemplate.getForObject(url, Goods.class);</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//feign调用</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods <span class="token operator">=</span> goodsFeign<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69</p><h3 id="三、其他设置" tabindex="-1"><a class="header-anchor" href="#三、其他设置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81%E5%85%B6%E4%BB%96%E8%AE%BE%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>三、其他设置</span></a></h3><h4 id="_1、超时设置" tabindex="-1"><a class="header-anchor" href="#_1、超时设置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81%E8%B6%85%E6%97%B6%E8%AE%BE%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>1、超时设置</span></a></h4><p>• Feign 底层依赖于 Ribbon 实现负载均衡和远程调用</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408171431530.17dcc892.png" alt="image-20220408171431530"></p><p>• Ribbon默认1秒超时。</p><p>• 超时配置： yml中</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># 设置Ribbon的超时时间</span>
<span class="line">ribbon:</span>
<span class="line">  ConnectTimeout: 1000 # 连接超时时间 默认1s</span>
<span class="line">  ReadTimeout: 3000 # 逻辑处理的超时时间 默认1s</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><p>测试：</p><p>1.连接超时，provider都停掉</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408172036937.989a933a.png" alt="image-20220408172036937"></p><p>2.逻辑处理的超时时间</p><p>provider</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">    @GetMapping(&quot;/findById/{id}&quot;)</span>
<span class="line">    public Goods findById(@PathVariable(&quot;id&quot;) Integer id){</span>
<span class="line">        Goods goods = goodsService.findById(id);</span>
<span class="line">        goods.setTitle(goods.getTitle()+&quot;|端口号：&quot;+port);</span>
<span class="line">        </span>
<span class="line">        //模拟业务逻辑比较繁忙</span>
<span class="line">        try {</span>
<span class="line">            Thread.sleep(5000);</span>
<span class="line">        } catch (InterruptedException e) {</span>
<span class="line">            e.printStackTrace();</span>
<span class="line">        }</span>
<span class="line">        return goods;</span>
<span class="line">    }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408172302166.9b28bb4d.png" alt="image-20220408172302166"></p><h4 id="_2、日志记录" tabindex="-1"><a class="header-anchor" href="#_2、日志记录"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95" target="_blank" rel="noopener noreferrer">#</a>2、日志记录</span></a></h4><p>1.Feign 只能记录 debug 级别的日志信息。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># 设置当前的日志级别 debug，feign只支持记录debug级别的日志</span>
<span class="line">logging:</span>
<span class="line">  level:</span>
<span class="line">    com.ydlclass: debug</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><p>• 定义Feign日志级别Bean</p><p>FeignLogConfig</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">feign<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FeignLogConfig</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token comment">/*</span>
<span class="line">        NONE,不记录</span>
<span class="line">        BASIC,记录基本的请求行，响应状态码数据</span>
<span class="line">        HEADERS,记录基本的请求行，响应状态码数据，记录响应头信息</span>
<span class="line">        FULL;记录完成的请求 响应数据</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">     */</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token function">level</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span><span class="token constant">FULL</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</p><ol><li>启用该Bean：</li></ol><p>GoodsFeignClient</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">@FeignClient(value = &quot;FEIGN-PROVIDER&quot;,configuration = FeignLogConfig.class)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><h2 id="" tabindex="-1"><a class="header-anchor" href="#"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#" target="_blank" rel="noopener noreferrer">#</a><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408182551922.f2ea6561.png" alt="image-20220408182551922"></span></a></h2><p>设置为headers</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220408182713438.68ea41ae.png" alt="image-20220408182713438"></p><h2 id="第十章-hystrix断路器-豪猪-保险丝" tabindex="-1"><a class="header-anchor" href="#第十章-hystrix断路器-豪猪-保险丝"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%8D%81%E7%AB%A0-hystrix%E6%96%AD%E8%B7%AF%E5%99%A8-%E8%B1%AA%E7%8C%AA-%E4%BF%9D%E9%99%A9%E4%B8%9D" target="_blank" rel="noopener noreferrer">#</a>第十章 Hystrix断路器 （豪猪）-保险丝</span></a></h2><h3 id="一、概述-1" tabindex="-1"><a class="header-anchor" href="#一、概述-1"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0-1" target="_blank" rel="noopener noreferrer">#</a>一、概述</span></a></h3><p>重点：能让服务的调用方，够快的知道被调方挂了！不至于说让用户在等待。</p><p>Hystix 是 Netflix 开源的一个延迟和容错库，用于隔离访问远程服务、第三方库，防止出现级联失败（雪崩）。</p><p>雪崩：一个服务失败，导致整条链路的服务都失败的情形。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411101214886.e1894fb1.png" alt="image-20220411101214886"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411104119551.5dbb216d.png" alt="image-20220411104119551"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411101248131.23fdbc68.png" alt="image-20220411101248131"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411101310179.039fb050.png" alt="image-20220411101310179"></p><p><strong>Hystix 主要功能</strong></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411101741096.ad89764b.png" alt="image-20220411101741096"></p><p><strong>隔离</strong></p><ol><li><p>线程池隔离</p><p>没有hystrix,a重试100次，才知道c挂了！</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411102317061.a569d3eb.png" alt="image-20220411102317061"></p><p>使用了hystrix,更细分线程池，只需要重试40次，让a更快的知道c挂了</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411102720425.31875f98.png" alt="image-20220411102720425"></p></li><li><p>信号量隔离</p><p>没有hystrix,a一个带着认证信息的线程，重试100次，才知道c挂了！</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411103036778.e2674a15.png" alt="image-20220411103036778"></p><p>使用了hystrix,更细分线程池，一个带着认证信息的线程,只需要重试40次，让a更快的知道c挂了</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411103152275.926f5142.png" alt="image-20220411103152275"></p></li></ol><p><strong>降级</strong>：</p><p>服务提供方降级(异常，超时)</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411104951728.51506d7b.png" alt="image-20220411104951728"></p><p>消费方降级</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411112946547.e3d81fb6.png" alt="image-20220411112946547"></p><p><strong>熔断</strong></p><p><strong>限流</strong></p><p>是有限流，但是，项目一般不用。nginx或者网关限流。</p><h3 id="二、服务降级" tabindex="-1"><a class="header-anchor" href="#二、服务降级"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7" target="_blank" rel="noopener noreferrer">#</a>二、服务降级</span></a></h3><p><strong>服务提供方</strong></p><p>a、在服务提供方，引入 hystrix 依赖</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">		<span class="token comment">&lt;!-- hystrix --&gt;</span></span>
<span class="line">         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-hystrix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p><p>b、方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/** 定义降级方法   返回特殊对象</span>
<span class="line">     *  1方法的返回值要和原方法一致</span>
<span class="line">     *  2方法参数和原方法一样</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById_fallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setGoodId</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;provider提供方降级！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setStock</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13</p><p>c、使用 @HystrixCommand 注解配置降级方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/findById/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;findById_fallback&quot;</span><span class="token punctuation">,</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//设置Hystrix的超时时间，默认1s</span></span>
<span class="line">            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">&quot;3000&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods <span class="token operator">=</span> goodsService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>goods<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;|端口号：&quot;</span><span class="token operator">+</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//模拟出异常</span></span>
<span class="line"><span class="token comment">//        int a=1/0;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//模拟业务逻辑比较繁忙</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</p><p>d、在启动类上开启Hystrix功能：@EnableCircuitBreaker</p><p>测试：http://localhost:9000/order/add/10</p><p>1.出错，服务方降级了</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411110206538.c3351b31.png" alt="image-20220411110206538"></p><p>2.3000超时，服务方降级了</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411111020806.407514d5.png" alt="image-20220411111020806"></p><p><strong>服务消费方</strong></p><p>a、feign 组件已经集成了 hystrix 组件。</p><p>b、</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411113035040.f3c891d5.png" alt="image-20220411113035040"></p><p>c、定义feign 调用接口实现类，复写方法，即 降级方法</p><p>GoodsFeignClientFallback</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsFeignCallback</span> <span class="token keyword">implements</span> <span class="token class-name">GoodsFeign</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setGoodId</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;调用方降级了！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setStock</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23</p><p>d、在 @FeignClient 注解中使用 fallback 属性设置降级处理类。</p><p>GoodsFeignClient</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>feign</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">FeignLogConfig</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;EUREKA-PROVIDER&quot;</span><span class="token punctuation">,</span>configuration <span class="token operator">=</span> <span class="token class-name">FeignLogConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token class-name">GoodsFeignCallback</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">GoodsFeign</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/goods/findById/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19</p><p>e、配置开启</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># 开启feign对hystrix的支持</span>
<span class="line">feign:</span>
<span class="line">  hystrix:</span>
<span class="line">    enabled: true</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><p>测试：停掉provider</p><p>http://localhost:9000/order/add/10</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411113635280.1081b217.png" alt="image-20220411113635280"></p><h3 id="三、熔断" tabindex="-1"><a class="header-anchor" href="#三、熔断"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81%E7%86%94%E6%96%AD" target="_blank" rel="noopener noreferrer">#</a>三、熔断</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411114750082.1a48c986.png" alt="image-20220411114750082"></p><p>测试：</p><p>provider</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>proviver<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>javanica<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">HystrixCommand</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>javanica<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">HystrixProperty</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>proviver<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Goods</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>proviver<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">GoodsService</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/goods&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsController</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token class-name">GoodsService</span> goodsService<span class="token punctuation">;</span></span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">int</span> port<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/findById/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;findById_fallback&quot;</span><span class="token punctuation">,</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//设置Hystrix的超时时间，默认1s</span></span>
<span class="line">            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">&quot;3000&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods <span class="token operator">=</span> goodsService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>goods<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;|端口号：&quot;</span><span class="token operator">+</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//模拟出异常</span></span>
<span class="line">            <span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//模拟出异常</span></span>
<span class="line"><span class="token comment">//        int a=1/0;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//模拟业务逻辑比较繁忙</span></span>
<span class="line"><span class="token comment">//        try {</span></span>
<span class="line"><span class="token comment">//            Thread.sleep(5000);</span></span>
<span class="line"><span class="token comment">//        } catch (InterruptedException e) {</span></span>
<span class="line"><span class="token comment">//            e.printStackTrace();</span></span>
<span class="line"><span class="token comment">//        }</span></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/** 定义降级方法   返回特殊对象</span>
<span class="line">     *  1方法的返回值要和原方法一致</span>
<span class="line">     *  2方法参数和原方法一样</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Goods</span> <span class="token function">findById_fallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Goods</span> goods<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setGoodId</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;provider提供方降级！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        goods<span class="token punctuation">.</span><span class="token function">setStock</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> goods<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67</p><p>访问两个接口</p><ol><li>http://localhost:9000/order/add/10</li></ol><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411115310796.faba6ed0.png" alt="image-20220411115310796"></p><ol><li>多次访问 http://localhost:9000/order/add/1</li></ol><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411115332277.ce2b6c94.png" alt="image-20220411115332277"></p><p>3.导致10也不能访问了</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411115128870.15162f17.png" alt="image-20220411115128870"></p><p>4.再过一会儿，半开状态</p><p>http://localhost:9000/order/add/10</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411115423173.573f7494.png" alt="image-20220411115423173"></p><p>Hyst rix 熔断机制，用于监控微服务调用情况，当失败的情况达到预定的阈值（5秒失败20次），会打开断路器，拒绝所有请求，直到服务恢复正常为止。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">circuitBreaker.sleepWindowInMilliseconds：监控时间</span>
<span class="line">circuitBreaker.requestVolumeThreshold：失败次数</span>
<span class="line">circuitBreaker.errorThresholdPercentage：失败率</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3</p><p>提供者controller中</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">    <span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;findOne_fallback&quot;</span><span class="token punctuation">,</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//设置Hystrix的超时时间，默认1s</span></span>
<span class="line">            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">&quot;3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token comment">//监控时间 默认5000 毫秒</span></span>
<span class="line">            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;circuitBreaker.sleepWindowInMilliseconds&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">&quot;5000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token comment">//失败次数。默认20次</span></span>
<span class="line">            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;circuitBreaker.requestVolumeThreshold&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token comment">//失败率 默认50%</span></span>
<span class="line">            <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;circuitBreaker.errorThresholdPercentage&quot;</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token string">&quot;50&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11</p><h3 id="四、熔断监控-运维" tabindex="-1"><a class="header-anchor" href="#四、熔断监控-运维"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E5%9B%9B%E3%80%81%E7%86%94%E6%96%AD%E7%9B%91%E6%8E%A7-%E8%BF%90%E7%BB%B4" target="_blank" rel="noopener noreferrer">#</a>四、熔断监控**-运维</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200612072519498.077b0382.png" alt="image-20200612072519498"></p><p>Hystrix 提供了 Hystrix-dashboard 功能，用于实时监控微服务运行状态。</p><p>但是Hystrix-dashboard只能监控一个微服务。</p><p>Netflix 还提供了 Turbine ，进行聚合监控。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200612072621556.5e1b0aa0.png" alt="image-20200612072621556"></p><p><strong>Turbine聚合监控</strong></p><h4 id="_1、搭建监控模块" tabindex="-1"><a class="header-anchor" href="#_1、搭建监控模块"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81%E6%90%AD%E5%BB%BA%E7%9B%91%E6%8E%A7%E6%A8%A1%E5%9D%97" target="_blank" rel="noopener noreferrer">#</a>1、搭建监控模块</span></a></h4><p><strong>a、 创建监控模块</strong></p><p>创建hystrix-monitor模块，使用Turbine聚合监控多个Hystrix dashboard功能,</p><p><strong>b、引入Turbine聚合监控起步依赖</strong></p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hystrix-monitor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-hystrix-dashboard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-turbine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57</p><p><strong>d、修改application.yml</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> hystrix<span class="token punctuation">-</span>monitor</span>
<span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8769</span></span>
<span class="line"><span class="token key atrule">turbine</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">combine-host-port</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token comment"># 配置需要监控的服务名称列表</span></span>
<span class="line">  <span class="token key atrule">app-config</span><span class="token punctuation">:</span> EUREKA<span class="token punctuation">-</span>PROVIDER<span class="token punctuation">,</span>EUREKA<span class="token punctuation">-</span>CONSUMER</span>
<span class="line">  <span class="token key atrule">cluster-name-expression</span><span class="token punctuation">:</span> <span class="token string">&quot;&#39;default&#39;&quot;</span></span>
<span class="line">  <span class="token key atrule">aggregator</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">cluster-config</span><span class="token punctuation">:</span> default</span>
<span class="line">  <span class="token comment">#instanceUrlSuffix: /actuator/hystrix.stream</span></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">serviceUrl</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka/</span>
<span class="line"><span class="token key atrule">hystrix</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">dashboard</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">proxy-stream-allow-list</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21</p><p><strong>e、创建启动类</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>monitor</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span></span><span class="token class-name">EnableEurekaClient</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>dashboard<span class="token punctuation">.</span></span><span class="token class-name">EnableHystrixDashboard</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>turbine<span class="token punctuation">.</span></span><span class="token class-name">EnableTurbine</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token annotation punctuation">@EnableEurekaClient</span></span>
<span class="line"><span class="token annotation punctuation">@EnableTurbine</span> <span class="token comment">//开启Turbine 很聚合监控功能</span></span>
<span class="line"><span class="token annotation punctuation">@EnableHystrixDashboard</span> <span class="token comment">//开启Hystrix仪表盘监控功能</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HystrixMonitorApp</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">HystrixMonitorApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22</p><h4 id="_2、修改被监控模块" tabindex="-1"><a class="header-anchor" href="#_2、修改被监控模块"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81%E4%BF%AE%E6%94%B9%E8%A2%AB%E7%9B%91%E6%8E%A7%E6%A8%A1%E5%9D%97" target="_blank" rel="noopener noreferrer">#</a>2、修改被监控模块</span></a></h4><p>需要分别修改 hystrix-provider 和 hystrix-consumer 模块：</p><p><strong>a、导入依赖：</strong></p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-hystrix<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-hystrix-dashboard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14</p><p><strong>b、配置Bean</strong></p><p>此处为了方便，将其配置在启动类中。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">	<span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">HystrixMetricsStreamServlet</span> streamServlet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HystrixMetricsStreamServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">ServletRegistrationBean</span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">(</span>streamServlet<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        registrationBean<span class="token punctuation">.</span><span class="token function">setLoadOnStartup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        registrationBean<span class="token punctuation">.</span><span class="token function">addUrlMappings</span><span class="token punctuation">(</span><span class="token string">&quot;/actuator/hystrix.stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        registrationBean<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;HystrixMetricsStreamServlet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9</p><p><strong>c、启动类上添加注解@EnableHystrixDashboard</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@EnableDiscoveryClient</span></span>
<span class="line"><span class="token annotation punctuation">@EnableEurekaClient</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token annotation punctuation">@EnableFeignClients</span> </span>
<span class="line"><span class="token annotation punctuation">@EnableHystrixDashboard</span> <span class="token comment">// 开启Hystrix仪表盘监控功能</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerApp</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConsumerApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ServletRegistrationBean</span> <span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">HystrixMetricsStreamServlet</span> streamServlet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HystrixMetricsStreamServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">ServletRegistrationBean</span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">(</span>streamServlet<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        registrationBean<span class="token punctuation">.</span><span class="token function">setLoadOnStartup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        registrationBean<span class="token punctuation">.</span><span class="token function">addUrlMappings</span><span class="token punctuation">(</span><span class="token string">&quot;/actuator/hystrix.stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        registrationBean<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;HystrixMetricsStreamServlet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22</p><h4 id="_3、启动测试" tabindex="-1"><a class="header-anchor" href="#_3、启动测试"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_3%E3%80%81%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95" target="_blank" rel="noopener noreferrer">#</a>3、启动测试</span></a></h4><p><strong>a、启动服务：</strong></p><ul><li>eureka-server</li><li>hystrix-provider</li><li>hystrix-consumer</li><li>hystrix-monitor</li></ul><p><strong>b、访问：</strong></p><p>在浏览器访问http://localhost:8769/hystrix/ 进入Hystrix Dashboard界面</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1585421193757.41f28cbc.png" alt="1585421193757"></p><p>界面中输入监控的Url地址 http://localhost:8769/turbine.stream，监控时间间隔2000毫秒和title，如下图</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411154048113.1c256874.png" alt="image-20220411154048113"></p><ul><li>实心圆：它有颜色和大小之分，分别代表实例的监控程度和流量大小。如上图所示，它的健康度从绿色、黄色、橙色、红色递减。通过该实心圆的展示，我们就可以在大量的实例中快速的发现故障实例和高压力实例。</li><li>曲线：用来记录 2 分钟内流量的相对变化，我们可以通过它来观察到流量的上升和下降趋势。</li></ul><h2 id="第十一章、zuul路由网关" tabindex="-1"><a class="header-anchor" href="#第十一章、zuul路由网关"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%E3%80%81zuul%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3" target="_blank" rel="noopener noreferrer">#</a>第十一章、zuul路由网关</span></a></h2><p>zuul核心人员走了两个，zuul2的研发过久，spring公司等不及，自己研发的Gateway网关。</p><p>https://github.com/Netflix/zuul/wiki</p><h2 id="第十二章-gateway新一代网关" tabindex="-1"><a class="header-anchor" href="#第十二章-gateway新一代网关"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-gateway%E6%96%B0%E4%B8%80%E4%BB%A3%E7%BD%91%E5%85%B3" target="_blank" rel="noopener noreferrer">#</a>第十二章 Gateway新一代网关</span></a></h2><p>功能：路由+过滤</p><h3 id="一、-概述" tabindex="-1"><a class="header-anchor" href="#一、-概述"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81-%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">#</a>一、 <strong>概述</strong></span></a></h3><p>https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/</p><p>不使用</p><p>存在的问题：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">解决缺点：1客户端需要记录不同微服务地址，增加客户端的复杂性</span>
<span class="line">2每个后台微服务都需要认证</span>
<span class="line">3http 发请求，涉及到跨域</span>
<span class="line">4后台新增微服务，不能动态知道地址</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411172117753.e3893d54.png" alt="image-20220411172117753"></p><p>使用了网关的话：</p><p>• 网关旨在为微服务架构提供一种简单而有效的统一的API路由管理方式。</p><p>• 在微服务架构中，不同的微服务可以有不同的网络地址，各个微服务之间通过互相调用完成用户请求，客户端可能通过调用N个微服务的接口完成一个用户请求。</p><p>• 网关就是系统的入口，封装了应用程序的内部结构，为客户端提供统一服务，一些与业务本身功能无关的公共逻辑可以在这里实现，诸如认证、鉴权、监控、缓存、负载均衡、流量管控、路由转发等</p><p>• 在目前的网关解决方案里，有Nginx+ Lua、Netflix Zuul/zuul2 、Spring Cloud Gateway等等</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411172632761.c415bd79.png" alt="image-20220411172632761"></p><h3 id="二、-快速入门" tabindex="-1"><a class="header-anchor" href="#二、-快速入门"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8" target="_blank" rel="noopener noreferrer">#</a>二、 <strong>快速入门</strong></span></a></h3><p>（1）搭建网关模块 api-gateway-server</p><p>（2）引入依赖：starter-gateway</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gateway-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>api-gateway-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token comment">&lt;!--引入gateway 网关--&gt;</span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">&lt;!-- eureka-client --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30</p><p>（3）编写启动类</p><p>ApiGatewayApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>gateway</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>eureka<span class="token punctuation">.</span></span><span class="token class-name">EnableEurekaClient</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token annotation punctuation">@EnableEurekaClient</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiGatewayApp</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ApiGatewayApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15</p><p>（4）编写配置文件</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">server:</span>
<span class="line">  port: 80</span>
<span class="line"></span>
<span class="line">spring:</span>
<span class="line">  application:</span>
<span class="line">    name: api-gateway-server</span>
<span class="line"></span>
<span class="line">  cloud:</span>
<span class="line">    # 网关配置</span>
<span class="line">    gateway:</span>
<span class="line">      # 路由配置：转发规则</span>
<span class="line">      routes: #集合。</span>
<span class="line">      # id: 唯一标识。默认是一个UUID</span>
<span class="line">      # uri: 转发路径</span>
<span class="line">      # predicates: 条件,用于请求网关路径的匹配规则</span>
<span class="line">      # filters：配置局部过滤器的</span>
<span class="line"></span>
<span class="line">      - id: eureka-provider</span>
<span class="line">        # 静态路由</span>
<span class="line">        # uri: http://localhost:8001/</span>
<span class="line">        # 动态路由</span>
<span class="line">        uri: lb://GATEWAY-PROVIDER</span>
<span class="line">        predicates:</span>
<span class="line">        - Path=/goods/**</span>
<span class="line">        filters:</span>
<span class="line">        - AddRequestParameter=username,zhangsan</span>
<span class="line"></span>
<span class="line">      - id: eureka-consumer</span>
<span class="line">        # uri: http://localhost:9000</span>
<span class="line">        uri: lb://GATEWAY-CONSUMER</span>
<span class="line">        predicates:</span>
<span class="line">        - Path=/order/**</span>
<span class="line">        # 微服务名称配置</span>
<span class="line">      discovery:</span>
<span class="line">        locator:</span>
<span class="line">          enabled: true # 设置为true 请求路径前可以添加微服务名称</span>
<span class="line">          lower-case-service-id: true # 允许为小写</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">eureka:</span>
<span class="line">  client:</span>
<span class="line">    service-url:</span>
<span class="line">      defaultZone: http://localhost:8761/eureka</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43</p><p>（5）启动测试</p><p>http://localhost/goods/findById/2</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411174704253.4e93d626.png" alt="image-20220411174704253"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411174649892.b2b39013.png" alt="image-20220411174649892"></p><h3 id="三、-静态路由" tabindex="-1"><a class="header-anchor" href="#三、-静态路由"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1" target="_blank" rel="noopener noreferrer">#</a>三、 <strong>静态路由</strong></span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">uri: http://localhost:8000/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><h3 id="四、动态路由" tabindex="-1"><a class="header-anchor" href="#四、动态路由"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E5%9B%9B%E3%80%81%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1" target="_blank" rel="noopener noreferrer">#</a>四、<strong>动态路由</strong></span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411180512597.da56cec1.png" alt="image-20220411180512597"></p><h4 id="_1、引入eureka-client配置" tabindex="-1"><a class="header-anchor" href="#_1、引入eureka-client配置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_1%E3%80%81%E5%BC%95%E5%85%A5eureka-client%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>1、引入eureka-client配置</span></a></h4><p>pom</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">		&lt;dependency&gt;</span>
<span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span>
<span class="line">        &lt;/dependency&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><p>yml</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">eureka:</span>
<span class="line">  client:</span>
<span class="line">    service-url:</span>
<span class="line">      defaultZone: http://localhost:8761/eureka</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><h4 id="_2、修改uri属性-uri-lb-服务名称" tabindex="-1"><a class="header-anchor" href="#_2、修改uri属性-uri-lb-服务名称"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#_2%E3%80%81%E4%BF%AE%E6%94%B9uri%E5%B1%9E%E6%80%A7-uri-lb-%E6%9C%8D%E5%8A%A1%E5%90%8D%E7%A7%B0" target="_blank" rel="noopener noreferrer">#</a>2、修改uri属性：uri: lb://服务名称</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">uri: lb://eureka-provider</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p>测试：</p><p>http://localhost/goods/findById/2</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411180644761.e575ff25.png" alt="image-20220411180644761"></p><h3 id="五、微服务名称配置" tabindex="-1"><a class="header-anchor" href="#五、微服务名称配置"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%94%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%90%8D%E7%A7%B0%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#</a>五、微服务名称配置**</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">spring:</span>
<span class="line">  cloud:</span>
<span class="line">    # 网关配置</span>
<span class="line">    gateway:   </span>
<span class="line">    # 微服务名称配置</span>
<span class="line">      discovery:</span>
<span class="line">        locator:</span>
<span class="line">          enabled: true # 设置为true 请求路径前可以添加微服务名称</span>
<span class="line">          lower-case-service-id: true # 允许为小写</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9</p><p>测试：http://localhost/eureka-provider/goods/findById/2</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411180853933.7e0bf46f.png" alt="image-20220411180853933"></p><h3 id="六、过滤器" tabindex="-1"><a class="header-anchor" href="#六、过滤器"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E5%85%AD%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8" target="_blank" rel="noopener noreferrer">#</a>六、过滤器</span></a></h3><p>（1）两个维度：</p><p>内置过滤器 自定义过滤器</p><p>局部过滤器 全局过滤器</p><p>（2）过滤器种类：</p><p>内置局部过滤器</p><p>内置全局过滤器</p><p>自定义局部过滤器</p><p>自定义全局过滤器</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200612075159655.4dd53e5a.png" alt="image-20200612075159655"></p><ul><li><p>Gateway 支持过滤器功能，对请求或响应进行拦截，完成一些通用操作。</p></li><li><p>Gateway 提供两种过滤器方式：“pre”和“post”</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">pre 过滤器，在转发之前执行，可以做参数校验、权限校验、流量监控、日志输出、协议转换等。</span>
<span class="line">post 过滤器，在响应之前执行，可以做响应内容、响应头的修改，日志的输出，流量监控等。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2</p></li><li><p>Gateway 还提供了两种类型过滤器</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">GatewayFilter：局部过滤器，针对单个路由</span>
<span class="line">GlobalFilter ：全局过滤器，针对所有路由</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2</p></li></ul><p>内置过滤器 局部过滤器：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>provider</span>
<span class="line">     <span class="token comment">#uri: http://localhost:8001/</span></span>
<span class="line">     <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//GATEWAY<span class="token punctuation">-</span>PROVIDER</span>
<span class="line">     <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">     <span class="token punctuation">-</span> Path=/goods/<span class="token important">**</span></span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token punctuation">-</span> AddResponseHeader=foo<span class="token punctuation">,</span> bar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411182635931.65d3b487.png" alt="image-20220411182635931"></p><p>内置过滤器 全局过滤器： route同级</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">      default-filters:</span>
<span class="line">        - AddResponseHeader=yld,itlils</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411182831552.1af37136.png" alt="image-20220411182831552"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411182910608.586ba685.png" alt="image-20220411182910608"></p><p><strong>拓展：</strong></p><p>内置的过滤器工厂</p><p>这里简单将Spring Cloud Gateway内置的所有过滤器工厂整理成了一张表格。如下：</p><table><thead><tr><th style="text-align:left;">过滤器工厂</th><th style="text-align:left;">作用</th><th style="text-align:left;">参数</th></tr></thead><tbody><tr><td style="text-align:left;">AddRequestHeader</td><td style="text-align:left;">为原始请求添加Header</td><td style="text-align:left;">Header的名称及值</td></tr><tr><td style="text-align:left;">AddRequestParameter</td><td style="text-align:left;">为原始请求添加请求参数</td><td style="text-align:left;">参数名称及值</td></tr><tr><td style="text-align:left;">AddResponseHeader</td><td style="text-align:left;">为原始响应添加Header</td><td style="text-align:left;">Header的名称及值</td></tr><tr><td style="text-align:left;">DedupeResponseHeader</td><td style="text-align:left;">剔除响应头中重复的值</td><td style="text-align:left;">需要去重的Header名称及去重策略</td></tr><tr><td style="text-align:left;">Hystrix</td><td style="text-align:left;">为路由引入Hystrix的断路器保护</td><td style="text-align:left;"><code>HystrixCommand</code>的名称</td></tr><tr><td style="text-align:left;">FallbackHeaders</td><td style="text-align:left;">为fallbackUri的请求头中添加具体的异常信息</td><td style="text-align:left;">Header的名称</td></tr><tr><td style="text-align:left;">PrefixPath</td><td style="text-align:left;">为原始请求路径添加前缀</td><td style="text-align:left;">前缀路径</td></tr><tr><td style="text-align:left;">PreserveHostHeader</td><td style="text-align:left;">为请求添加一个preserveHostHeader=true的属性，路由过滤器会检查该属性以决定是否要发送原始的Host</td><td style="text-align:left;">无</td></tr><tr><td style="text-align:left;">RequestRateLimiter</td><td style="text-align:left;">用于对请求限流，限流算法为令牌桶</td><td style="text-align:left;">keyResolver、rateLimiter、statusCode、denyEmptyKey、emptyKeyStatus</td></tr><tr><td style="text-align:left;">RedirectTo</td><td style="text-align:left;">将原始请求重定向到指定的URL</td><td style="text-align:left;">http状态码及重定向的url</td></tr><tr><td style="text-align:left;">RemoveHopByHopHeadersFilter</td><td style="text-align:left;">为原始请求删除IETF组织规定的一系列Header</td><td style="text-align:left;">默认就会启用，可以通过配置指定仅删除哪些Header</td></tr><tr><td style="text-align:left;">RemoveRequestHeader</td><td style="text-align:left;">为原始请求删除某个Header</td><td style="text-align:left;">Header名称</td></tr><tr><td style="text-align:left;">RemoveResponseHeader</td><td style="text-align:left;">为原始响应删除某个Header</td><td style="text-align:left;">Header名称</td></tr><tr><td style="text-align:left;">RewritePath</td><td style="text-align:left;">重写原始的请求路径</td><td style="text-align:left;">原始路径正则表达式以及重写后路径的正则表达式</td></tr><tr><td style="text-align:left;">RewriteResponseHeader</td><td style="text-align:left;">重写原始响应中的某个Header</td><td style="text-align:left;">Header名称，值的正则表达式，重写后的值</td></tr><tr><td style="text-align:left;">SaveSession</td><td style="text-align:left;">在转发请求之前，强制执行<code>WebSession::save</code>操作</td><td style="text-align:left;">无</td></tr><tr><td style="text-align:left;">secureHeaders</td><td style="text-align:left;">为原始响应添加一系列起安全作用的响应头</td><td style="text-align:left;">无，支持修改这些安全响应头的值</td></tr><tr><td style="text-align:left;">SetPath</td><td style="text-align:left;">修改原始的请求路径</td><td style="text-align:left;">修改后的路径</td></tr><tr><td style="text-align:left;">SetResponseHeader</td><td style="text-align:left;">修改原始响应中某个Header的值</td><td style="text-align:left;">Header名称，修改后的值</td></tr><tr><td style="text-align:left;">SetStatus</td><td style="text-align:left;">修改原始响应的状态码</td><td style="text-align:left;">HTTP 状态码，可以是数字，也可以是字符串</td></tr><tr><td style="text-align:left;">StripPrefix</td><td style="text-align:left;">用于截断原始请求的路径</td><td style="text-align:left;">使用数字表示要截断的路径的数量</td></tr><tr><td style="text-align:left;">Retry</td><td style="text-align:left;">针对不同的响应进行重试</td><td style="text-align:left;">retries、statuses、methods、series</td></tr><tr><td style="text-align:left;">RequestSize</td><td style="text-align:left;">设置允许接收最大请求包的大小。如果请求包大小超过设置的值，则返回 <code>413 Payload Too Large</code></td><td style="text-align:left;">请求包大小，单位为字节，默认值为5M</td></tr><tr><td style="text-align:left;">ModifyRequestBody</td><td style="text-align:left;">在转发请求之前修改原始请求体内容</td><td style="text-align:left;">修改后的请求体内容</td></tr><tr><td style="text-align:left;">ModifyResponseBody</td><td style="text-align:left;">修改原始响应体的内容</td><td style="text-align:left;">修改后的响应体内容</td></tr><tr><td style="text-align:left;">Default</td><td style="text-align:left;">为所有路由添加过滤器</td><td style="text-align:left;">过滤器工厂名称及值</td></tr></tbody></table><p>**Tips：**每个过滤器工厂都对应一个实现类，并且这些类的名称必须以<code>GatewayFilterFactory</code>结尾，这是Spring Cloud Gateway的一个约定，例如<code>AddRequestHeader</code>对应的实现类为<code>AddRequestHeaderGatewayFilterFactory</code>。</p><hr><p>1、AddRequestHeader GatewayFilter Factory</p><p>为原始请求添加Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_header_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>为原始请求添加名为 <code>X-Request-Foo</code> ，值为 <code>Bar</code> 的请求头</p><p>2、AddRequestParameter GatewayFilter Factory</p><p>为原始请求添加请求参数及值，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_parameter_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> AddRequestParameter=foo<span class="token punctuation">,</span> bar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>为原始请求添加名为foo，值为bar的参数，即：<code>foo=bar</code></p><p>3、AddResponseHeader GatewayFilter Factory</p><p>为原始响应添加Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_response_header_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>为原始响应添加名为 <code>X-Request-Foo</code> ，值为 <code>Bar</code> 的响应头</p><p>4、DedupeResponseHeader GatewayFilter Factory</p><p>DedupeResponseHeader可以根据配置的Header名称及去重策略剔除响应头中重复的值，这是Spring Cloud Greenwich SR2提供的新特性，低于这个版本无法使用。</p><p>我们在Gateway以及微服务上都设置了CORS（解决跨域）Header的话，如果不做任何配置，那么请求 -&gt; 网关 -&gt; 微服务，获得的CORS Header的值，就将会是这样的：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">Access-Control-Allow-Credentials: true, <span class="token boolean">true</span></span>
<span class="line">Access-Control-Allow-Origin: https://musk.mars, https://musk.mars</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2</p><p>可以看到这两个Header的值都重复了，若想把这两个Header的值去重的话，就需要使用到DedupeResponseHeader，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> dedupe_response_header_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 若需要去重的Header有多个，使用空格分隔</span></span>
<span class="line">        <span class="token punctuation">-</span> DedupeResponseHeader=Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Credentials Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9</p><p>去重策略：</p><ul><li>RETAIN_FIRST：默认值，保留第一个值</li><li>RETAIN_LAST：保留最后一个值</li><li>RETAIN_UNIQUE：保留所有唯一值，以它们第一次出现的顺序保留</li></ul><p>若想对该过滤器工厂有个比较全面的了解的话，建议阅读该过滤器工厂的源码，因为源码里有详细的注释及示例，比官方文档写得还好：<code>org.springframework.cloud.gateway.filter.factory.DedupeResponseHeaderGatewayFilterFactory</code></p><p>5、Hystrix GatewayFilter Factory</p><p>为路由引入Hystrix的断路器保护，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> hystrix_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Hystrix=myCommandName</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>Hystrix是Spring Cloud第一代容错组件，不过已经进入维护模式，未来Hystrix会被Spring Cloud移除掉，取而代之的是Alibaba Sentinel/Resilience4J。所以本文不做详细介绍了，感兴趣的话可以参考官方文档：</p><ul><li><a href="https://cloud.spring.io/spring-cloud-static/Greenwich.SR2/single/spring-cloud.html#hystrix" target="_blank" rel="noopener noreferrer">Hystrix GatewayFilter Factoryopen in new window</a></li></ul><p>6、FallbackHeaders GatewayFilter Factory</p><p>同样是对Hystrix的支持，上一小节所介绍的过滤器工厂支持一个配置参数：<code>fallbackUri</code>，该配置用于当发生异常时将请求转发到一个特定的uri上。而<code>FallbackHeaders</code>这个过滤工厂可以在转发请求到该uri时添加一个Header，这个Header的值为具体的异常信息。配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//ingredients</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=//ingredients/<span class="token important">**</span></span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hystrix</span>
<span class="line">          <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients</span>
<span class="line">            <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/fallback</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9994</span></span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/fallback</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FallbackHeaders</span>
<span class="line">          <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">executionExceptionTypeHeaderName</span><span class="token punctuation">:</span> Test<span class="token punctuation">-</span>Header</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21</p><p>这里也不做详细介绍了，感兴趣可以参考官方文档：</p><ul><li><a href="https://cloud.spring.io/spring-cloud-static/Greenwich.SR2/single/spring-cloud.html#fallback-headers" target="_blank" rel="noopener noreferrer">FallbackHeaders GatewayFilter Factoryopen in new window</a></li></ul><p>7、PrefixPath GatewayFilter Factory</p><p>为原始的请求路径添加一个前缀路径，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> PrefixPath=/mypath</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>该配置使访问<code>${GATEWAY_URL}/hello</code> 会转发到<code>https://example.org/mypath/hello</code></p><p>8、PreserveHostHeader GatewayFilter Factory</p><p>为请求添加一个preserveHostHeader=true的属性，路由过滤器会检查该属性以决定是否要发送原始的Host Header。配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> preserve_host_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> PreserveHostHeader</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>如果不设置，那么名为 <code>Host</code> 的Header将由Http Client控制</p><p>9、RequestRateLimiter GatewayFilter Factory</p><p>用于对请求进行限流，限流算法为令牌桶。配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> requestratelimiter_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter</span>
<span class="line">          <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">redis-rate-limiter.replenishRate</span><span class="token punctuation">:</span> <span class="token number">10</span></span>
<span class="line">            <span class="token key atrule">redis-rate-limiter.burstCapacity</span><span class="token punctuation">:</span> <span class="token number">20</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11</p><p>由于另一篇文章中已经介绍过如何使用该过滤器工厂实现网关限流，所以这里就不再赘述了：</p><ul><li><a href="https://blog.51cto.com/zero01/2430532" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway - 扩展open in new window</a></li></ul><p>或者参考官方文档：</p><ul><li><a href="https://cloud.spring.io/spring-cloud-static/Greenwich.SR2/single/spring-cloud.html#_requestratelimiter_gatewayfilter_factory" target="_blank" rel="noopener noreferrer">RequestRateLimiter GatewayFilter Factoryopen in new window</a></li></ul><p>10、RedirectTo GatewayFilter Factory</p><p>将原始请求重定向到指定的Url，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> redirect_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> RedirectTo=302<span class="token punctuation">,</span> https<span class="token punctuation">:</span>//acme.org</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>该配置使访问 <code>${GATEWAY_URL}/hello</code> 会被重定向到 <code>https://acme.org/hello</code> ，并且携带一个 <code>Location:http://acme.org</code> 的Header，而返回客户端的HTTP状态码为302</p><p>注意事项：</p><ul><li>HTTP状态码应为3xx，例如301</li><li>URL必须是合法的URL，该URL会作为<code>Location</code> Header的值</li></ul><p>11、RemoveHopByHopHeadersFilter GatewayFilter Factory</p><p>为原始请求删除<a href="https://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-14#section-7.1.3" target="_blank" rel="noopener noreferrer">IETFopen in new window</a>组织规定的一系列Header，默认删除的Header如下：</p><ul><li>Connection</li><li>Keep-Alive</li><li>Proxy-Authenticate</li><li>Proxy-Authorization</li><li>TE</li><li>Trailer</li><li>Transfer-Encoding</li><li>Upgrade</li></ul><p>可以通过配置去指定仅删除哪些Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">filter</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">remove-hop-by-hop</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token comment"># 多个Header使用逗号（,）分隔</span></span>
<span class="line">          <span class="token key atrule">headers</span><span class="token punctuation">:</span> Connection<span class="token punctuation">,</span>Keep<span class="token punctuation">-</span>Alive</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7</p><p>12、RemoveRequestHeader GatewayFilter Factory</p><p>为原始请求删除某个Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removerequestheader_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> RemoveRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Foo</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>删除原始请求中名为 <code>X-Request-Foo</code> 的请求头</p><p>13、RemoveResponseHeader GatewayFilter Factory</p><p>为原始响应删除某个Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removeresponseheader_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> RemoveResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>删除原始响应中名为 <code>X-Request-Foo</code> 的响应头</p><p>14、RewritePath GatewayFilter Factory</p><p>通过正则表达式重写原始的请求路径，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewritepath_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/foo/<span class="token important">**</span></span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 参数1为原始路径的正则表达式，参数2为重写后路径的正则表达式</span></span>
<span class="line">        <span class="token punctuation">-</span> RewritePath=/foo/(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">&gt;</span>.<span class="token important">*)</span><span class="token punctuation">,</span> /$\<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12</p><p>该配置使得访问 <code>/foo/bar</code> 时，会将路径重写为<code>/bar</code> 再进行转发，也就是会转发到 <code>https://example.org/bar</code>。需要注意的是：由于YAML语法，需用<code>$\</code> 替换 <code>$</code></p><p>15、RewriteResponseHeader GatewayFilter Factory</p><p>重写原始响应中的某个Header，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewriteresponseheader_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 参数1为Header名称，参数2为值的正则表达式，参数3为重写后的值</span></span>
<span class="line">        <span class="token punctuation">-</span> RewriteResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> password=<span class="token punctuation">[</span>^&amp;<span class="token punctuation">]</span>+<span class="token punctuation">,</span> password=<span class="token important">***</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10</p><p>该配置的意义在于：如果响应头中 <code>X-Response-Foo</code> 的值为<code>/42?user=ford&amp;password=omg!what&amp;flag=true</code>，那么就会被按照配置的值重写成<code>/42?user=ford&amp;password=***&amp;flag=true</code>，也就是把其中的<code>password=omg!what</code>重写成了<code>password=***</code></p><p>16、SaveSession GatewayFilter Factory</p><p>在转发请求之前，强制执行<code>WebSession::save</code>操作，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> save_session</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/foo/<span class="token important">**</span></span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> SaveSession</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11</p><p>主要用在那种像 Spring Session 延迟数据存储（数据不是立刻持久化）的，并希望在请求转发前确保session状态保存情况。如果你将Spring Secutiry于Spring Session集成使用，并想确保安全信息都传到下游机器，你就需要配置这个filter。</p><p>17、secureHeaders GatewayFilter Factory</p><p>secureHeaders过滤器工厂主要是参考了<a href="https://blog.appcanary.com/2017/http-security-headers.html" target="_blank" rel="noopener noreferrer">这篇博客open in new window</a>中的建议，为原始响应添加了一系列起安全作用的响应头。默认会添加如下Headers（包括值）：</p><ul><li><code>X-Xss-Protection:1; mode=block</code></li><li><code>Strict-Transport-Security:max-age=631138519</code></li><li><code>X-Frame-Options:DENY</code></li><li><code>X-Content-Type-Options:nosniff</code></li><li><code>Referrer-Policy:no-referrer</code></li><li><code>Content-Security-Policy:default-src &#39;self&#39; https:; font-src &#39;self&#39; https: data:; img-src &#39;self&#39; https: data:; object-src &#39;none&#39;; script-src https:; style-src &#39;self&#39; https: &#39;unsafe-inline&#39;</code></li><li><code>X-Download-Options:noopen</code></li><li><code>X-Permitted-Cross-Domain-Policies:none</code></li></ul><p>如果你想修改这些Header的值，那么就需要使用这些Headers对应的后缀，如下：</p><ul><li><code>xss-protection-header</code></li><li><code>strict-transport-security</code></li><li><code>frame-options</code></li><li><code>content-type-options</code></li><li><code>referrer-policy</code></li><li><code>content-security-policy</code></li><li><code>download-options</code></li><li><code>permitted-cross-domain-policies</code></li></ul><p>配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">filter</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">secure-headers</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token comment"># 修改 X-Xss-Protection 的值为 2; mode=unblock</span></span>
<span class="line">          <span class="token key atrule">xss-protection-header</span><span class="token punctuation">:</span> 2; mode=unblock</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7</p><p>如果想禁用某些Header，可使用如下配置：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">filter</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">secure-headers</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token comment"># 多个使用逗号（,）分隔</span></span>
<span class="line">          <span class="token key atrule">disable</span><span class="token punctuation">:</span> frame<span class="token punctuation">-</span>options<span class="token punctuation">,</span>download<span class="token punctuation">-</span>options</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8</p><p>18、SetPath GatewayFilter Factory</p><p>修改原始的请求路径，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setpath_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/foo/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> SetPath=/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11</p><p>该配置使访问 <code>${GATEWAY_URL}/foo/bar</code> 时会转发到 <code>https://example.org/bar</code> ，也就是原本的<code>/foo/bar</code>被修改为了<code>/bar</code></p><p>19、SetResponseHeader GatewayFilter Factory</p><p>修改原始响应中某个Header的值，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setresponseheader_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> SetResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9</p><p>将原始响应中 <code>X-Response-Foo</code> 的值修改为 <code>Bar</code></p><p>20、SetStatus GatewayFilter Factory</p><p>修改原始响应的状态码，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusstring_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 字符串形式</span></span>
<span class="line">        <span class="token punctuation">-</span> SetStatus=BAD_REQUEST</span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusint_route</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org</span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 数字形式</span></span>
<span class="line">        <span class="token punctuation">-</span> SetStatus=401</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14</p><p>SetStatusd的值可以是数字，也可以是字符串。但一定要是Spring <code>HttpStatus</code> 枚举类中的值。上面这两种配置都可以返回401这个HTTP状态码。</p><p>21、StripPrefix GatewayFilter Factory</p><p>用于截断原始请求的路径，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> nameRoot</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nameservice</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Path=/name/<span class="token important">**</span></span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 数字表示要截断的路径的数量</span></span>
<span class="line">        <span class="token punctuation">-</span> StripPrefix=2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12</p><p>如上配置，如果请求的路径为 <code>/name/bar/foo</code> ，那么则会截断成<code>/foo</code>后进行转发 ，也就是会截断2个路径。</p><p>22、Retry GatewayFilter Factory</p><p>针对不同的响应进行重试，例如可以针对HTTP状态码进行重试，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> retry_test</span>
<span class="line">        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/flakey</span>
<span class="line">        <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> Host=<span class="token important">*.retry.com</span></span>
<span class="line">        <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Retry</span>
<span class="line">          <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span></span>
<span class="line">            <span class="token key atrule">statuses</span><span class="token punctuation">:</span> BAD_GATEWAY</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13</p><p>可配置如下参数：</p><ul><li><code>retries</code>：重试次数</li><li><code>statuses</code>：需要重试的状态码，取值在 <code>org.springframework.http.HttpStatus</code> 中</li><li><code>methods</code>：需要重试的请求方法，取值在 <code>org.springframework.http.HttpMethod</code> 中</li><li><code>series</code>：HTTP状态码序列，取值在 <code>org.springframework.http.HttpStatus.Series</code> 中</li></ul><p>23、RequestSize GatewayFilter Factory</p><p>设置允许接收最大请求包的大小，配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">routes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> request_size_route</span>
<span class="line">      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/upload</span>
<span class="line">      <span class="token key atrule">predicates</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> Path=/upload</span>
<span class="line">      <span class="token key atrule">filters</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestSize</span>
<span class="line">        <span class="token key atrule">args</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token comment"># 单位为字节</span></span>
<span class="line">          <span class="token key atrule">maxSize</span><span class="token punctuation">:</span> <span class="token number">5000000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14</p><p>如果请求包大小超过设置的值，则会返回 <code>413 Payload Too Large</code>以及一个<code>errorMessage</code></p><p>24、Modify Request Body GatewayFilter Factory</p><p>在转发请求之前修改原始请求体内容，该过滤器工厂只能通过代码配置，不支持在配置文件中配置。代码示例：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;rewrite_request_obj&quot;</span><span class="token punctuation">,</span> r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;*.rewriterequestobj.org&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">prefixPath</span><span class="token punctuation">(</span><span class="token string">&quot;/httpbin&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">modifyRequestBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Hello</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"> </span>
<span class="line"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> message<span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"> </span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"> </span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> message<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"> </span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27</p><blockquote><p>Tips：该过滤器工厂处于 <strong>BETA</strong> 状态，未来API可能会变化，生产环境请慎用</p></blockquote><p>25、Modify Response Body GatewayFilter Factory</p><p>可用于修改原始响应体的内容，该过滤器工厂同样只能通过代码配置，不支持在配置文件中配置。代码示例：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;rewrite_response_upper&quot;</span><span class="token punctuation">,</span> r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;*.rewriteresponseupper.org&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">prefixPath</span><span class="token punctuation">(</span><span class="token string">&quot;/httpbin&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">modifyResponseBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> s<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10</p><blockquote><p>Tips：该过滤器工厂处于 <strong>BETA</strong> 状态，未来API可能会变化，生产环境请慎用</p></blockquote><p>26、Default Filters</p><p>Default Filters用于为所有路由添加过滤器工厂，也就是说通过Default Filter所配置的过滤器工厂会作用到所有的路由上。配置示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">gateway</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Default<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Default<span class="token punctuation">-</span>Bar</span>
<span class="line">      <span class="token punctuation">-</span> PrefixPath=/httpbin</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6</p><hr><p>官方文档：https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#_gatewayfilter_factories</p><h4 id="自定义过滤器" tabindex="-1"><a class="header-anchor" href="#自定义过滤器"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8" target="_blank" rel="noopener noreferrer">#</a>自定义过滤器</span></a></h4><p>1、自定义 局部过滤器</p><p>麻烦，很少。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">//</span>
<span class="line">// Source code recreated from a .class file by IntelliJ IDEA</span>
<span class="line">// (powered by FernFlower decompiler)</span>
<span class="line">//</span>
<span class="line"></span>
<span class="line">package org.springframework.cloud.gateway.filter.factory;</span>
<span class="line"></span>
<span class="line">import java.util.Arrays;</span>
<span class="line">import java.util.List;</span>
<span class="line">import org.springframework.cloud.gateway.filter.GatewayFilter;</span>
<span class="line">import org.springframework.cloud.gateway.filter.GatewayFilterChain;</span>
<span class="line">import org.springframework.cloud.gateway.support.GatewayToStringStyler;</span>
<span class="line">import org.springframework.cloud.gateway.support.ServerWebExchangeUtils;</span>
<span class="line">import org.springframework.http.server.reactive.ServerHttpRequest;</span>
<span class="line">import org.springframework.util.StringUtils;</span>
<span class="line">import org.springframework.web.server.ServerWebExchange;</span>
<span class="line">import reactor.core.publisher.Mono;</span>
<span class="line"></span>
<span class="line">public class StripPrefixGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;StripPrefixGatewayFilterFactory.Config&gt; {</span>
<span class="line">    public static final String PARTS_KEY = &quot;parts&quot;;</span>
<span class="line"></span>
<span class="line">    public StripPrefixGatewayFilterFactory() {</span>
<span class="line">        super(StripPrefixGatewayFilterFactory.Config.class);</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    public List&lt;String&gt; shortcutFieldOrder() {</span>
<span class="line">        return Arrays.asList(&quot;parts&quot;);</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    public GatewayFilter apply(StripPrefixGatewayFilterFactory.Config config) {</span>
<span class="line">        return new GatewayFilter() {</span>
<span class="line">            public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {</span>
<span class="line">                ServerHttpRequest request = exchange.getRequest();</span>
<span class="line">                ServerWebExchangeUtils.addOriginalRequestUrl(exchange, request.getURI());</span>
<span class="line">                String path = request.getURI().getRawPath();</span>
<span class="line">                String[] originalParts = StringUtils.tokenizeToStringArray(path, &quot;/&quot;);</span>
<span class="line">                StringBuilder newPath = new StringBuilder(&quot;/&quot;);</span>
<span class="line"></span>
<span class="line">                for(int i = 0; i &lt; originalParts.length; ++i) {</span>
<span class="line">                    if (i &gt;= config.getParts()) {</span>
<span class="line">                        if (newPath.length() &gt; 1) {</span>
<span class="line">                            newPath.append(&#39;/&#39;);</span>
<span class="line">                        }</span>
<span class="line"></span>
<span class="line">                        newPath.append(originalParts[i]);</span>
<span class="line">                    }</span>
<span class="line">                }</span>
<span class="line"></span>
<span class="line">                if (newPath.length() &gt; 1 &amp;&amp; path.endsWith(&quot;/&quot;)) {</span>
<span class="line">                    newPath.append(&#39;/&#39;);</span>
<span class="line">                }</span>
<span class="line"></span>
<span class="line">                ServerHttpRequest newRequest = request.mutate().path(newPath.toString()).build();</span>
<span class="line">                exchange.getAttributes().put(ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR, newRequest.getURI());</span>
<span class="line">                return chain.filter(exchange.mutate().request(newRequest).build());</span>
<span class="line">            }</span>
<span class="line"></span>
<span class="line">            public String toString() {</span>
<span class="line">                return GatewayToStringStyler.filterToStringCreator(StripPrefixGatewayFilterFactory.this).append(&quot;parts&quot;, config.getParts()).toString();</span>
<span class="line">            }</span>
<span class="line">        };</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    public static class Config {</span>
<span class="line">        private int parts;</span>
<span class="line"></span>
<span class="line">        public Config() {</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        public int getParts() {</span>
<span class="line">            return this.parts;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        public void setParts(int parts) {</span>
<span class="line">            this.parts = parts;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79</p><p>2、自定义 全局过滤器</p><p>需求：1黑客ip，直接给你拒接掉。</p><p>2某些请求路径 如“goods/findById”,危险操作，记录日志。</p><p>自定义全局过滤器步骤：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">1. 定义类实现 GlobalFilter 和 Ordered接口</span>
<span class="line">2. 复写方法</span>
<span class="line">3. 完成逻辑处理</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3</p><p>IpFilter</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpRequest</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpResponse</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IpFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//写业务逻辑</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//1黑客ip，直接给你拒接掉。</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//拿到请求和响应，为所欲为</span></span>
<span class="line">        <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">InetSocketAddress</span> remoteAddress <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> hostName <span class="token operator">=</span> remoteAddress<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hostName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">InetAddress</span> address <span class="token operator">=</span> remoteAddress<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> hostAddress <span class="token operator">=</span> address<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hostAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> hostName1 <span class="token operator">=</span> address<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hostName1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>hostAddress<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.31.11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//拒绝</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//走完了，该到下一个过滤器了</span></span>
<span class="line">        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//返回数值，越小越先执行</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58</p><p>UrlFilter</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">package com.ydlclass.gateway.filter;</span>
<span class="line"></span>
<span class="line">import org.springframework.cloud.gateway.filter.GatewayFilterChain;</span>
<span class="line">import org.springframework.cloud.gateway.filter.GlobalFilter;</span>
<span class="line">import org.springframework.core.Ordered;</span>
<span class="line">import org.springframework.http.server.reactive.ServerHttpRequest;</span>
<span class="line">import org.springframework.http.server.reactive.ServerHttpResponse;</span>
<span class="line">import org.springframework.stereotype.Component;</span>
<span class="line">import org.springframework.web.server.ServerWebExchange;</span>
<span class="line">import reactor.core.publisher.Mono;</span>
<span class="line"></span>
<span class="line">import java.net.URI;</span>
<span class="line"></span>
<span class="line">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span>
<span class="line">@Component</span>
<span class="line">public class UrlFilter implements GlobalFilter, Ordered {</span>
<span class="line">    @Override</span>
<span class="line">    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {</span>
<span class="line">        //某些请求路径 如“goods/findById”,危险操作，记录日志。</span>
<span class="line"></span>
<span class="line">        //拿到请求和响应，为所欲为</span>
<span class="line">        ServerHttpRequest request = exchange.getRequest();</span>
<span class="line">        ServerHttpResponse response = exchange.getResponse();</span>
<span class="line"></span>
<span class="line">        URI uri = request.getURI();</span>
<span class="line">        String path = uri.getPath();</span>
<span class="line">        System.out.println(path);</span>
<span class="line"></span>
<span class="line">        if(path.contains(&quot;goods/findById&quot;)){</span>
<span class="line">            //打日志</span>
<span class="line">            System.out.println(&quot;path很危险！&quot;);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        return chain.filter(exchange);</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    @Override</span>
<span class="line">    public int getOrder() {</span>
<span class="line">        return 1;</span>
<span class="line">    }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46</p><p>测试：</p><p>1、ipfilter</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411191527069.40d06e6f.png" alt="image-20220411191527069"></p><p>把自己的ip设置为拒绝访问的话</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411191641610.d8bde2dd.png" alt="image-20220411191641610"></p><p>2、</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220411192132436.09d8d5e2.png" alt="image-20220411192132436"></p><h2 id="第十三章-分布式配置中心" tabindex="-1"><a class="header-anchor" href="#第十三章-分布式配置中心"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83" target="_blank" rel="noopener noreferrer">#</a>第十三章 分布式配置中心</span></a></h2><p>13-16组件，超大型公司才会用到</p><p>国内BATJ,或者国外FLAG:facebook linkedin amazon google</p><p>处理大规模微服务的技术。</p><h3 id="一、config-概述" tabindex="-1"><a class="header-anchor" href="#一、config-概述"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81config-%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">#</a>一、Config 概述</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418081959807.439382b4.png" alt="image-20220418081959807"></p><p>Spring Cloud Config 解决了在分布式场景下多环境配置文件的管理和维护。</p><p>好处：</p><p>• 集中管理配置文件</p><p>• 不同环境不同配置，动态化的配置更新</p><p>• 配置信息改变时，不需要重启即可更新配置信息到服务</p><h3 id="二、config-快速入门" tabindex="-1"><a class="header-anchor" href="#二、config-快速入门"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81config-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8" target="_blank" rel="noopener noreferrer">#</a>二、Config 快速入门</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418082533367.271fa629.png" alt="image-20220418082533367"></p><p><strong>config-server：</strong></p><ol><li><p>使用gitee创建远程仓库，上传配置文件</p><p>config-dev.yml</p></li><li><p>搭建 config-server 模块</p><p>ConfigServerApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">EnableConfigServer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token annotation punctuation">@EnableConfigServer</span> <span class="token comment">// 启用config server功能</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigServerApp</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConfigServerApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14</p></li><li><p>导入 config-server 依赖</p><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"> 		<span class="token comment">&lt;!-- config-server --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-config-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p></li><li><p>编写配置，设置 gitee 远程仓库地址</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>server</span>
<span class="line">  <span class="token comment"># spring cloud config</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># git 的 远程仓库地址</span></span>
<span class="line">        <span class="token key atrule">git</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//gitee.com/ydlclass_cch/ydlclass<span class="token punctuation">-</span>configs.git</span>
<span class="line">      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment"># 分支配置</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14</p></li><li><p>测试访问远程配置文件</p><p>http://localhost:9527/master/provider-dev.yml</p></li></ol><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418083733698.508dfd18.png" alt="image-20220418083733698"></p><p><strong>config-client：</strong> provider</p><ol><li><p>导入 starter-config 依赖</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">		<span class="token comment">&lt;!--config client --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p></li><li><p>配置config server 地址，读取配置文件名称等信息</p><p>bootstrap.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 配置config-server地址</span></span>
<span class="line"><span class="token comment"># 配置获得配置文件的名称等信息</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># 配置config-server地址</span></span>
<span class="line">      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9527</span></span>
<span class="line">      <span class="token comment"># 配置获得配置文件的名称等信息</span></span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> provider <span class="token comment"># 文件名</span></span>
<span class="line">      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment"># profile指定，  config-dev.yml</span></span>
<span class="line">      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment"># 分支</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11</p></li><li><p>获取配置值</p><p>GoodsController</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${ydlclass}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> ydlclass<span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    goods<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>goods<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;|端口号：&quot;</span><span class="token operator">+</span>port<span class="token operator">+</span><span class="token string">&quot;|ydlclass&quot;</span><span class="token operator">+</span>ydlclass<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p></li><li><p>启动测试</p><p>http://localhost:8000/goods/findById/9</p></li></ol><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418084608302.978afefa.png" alt="image-20220418084608302"></p><p><strong>Config 客户端刷新</strong></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418085057098.ae365b9f.png" alt="image-20220418085057098"></p><ol><li><p>在 config 客户端引入 actuator 依赖</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p></li><li><p>获取配置信息类上，添加 @RefreshScope 注解</p><p>GoodsController</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">// 开启刷新功能</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p></li><li><p>添加配置</p><p>bootstrap.yml</p></li></ol><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">management</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">web</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p><ol><li><p>使用curl工具发送post请求</p><p>curl -X POST http://localhost:8000/actuator/refresh</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418085907801.edb89cde.png" alt="image-20220418085907801"></p></li></ol><p>测试： 值已经变了</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418085930400.9adcb0c7.png" alt="image-20220418085930400"></p><h3 id="三、config-集成eureka" tabindex="-1"><a class="header-anchor" href="#三、config-集成eureka"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81config-%E9%9B%86%E6%88%90eureka" target="_blank" rel="noopener noreferrer">#</a>三、Config 集成Eureka</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418090254336.8b4469ba.png" alt="image-20220418090254336"></p><p><strong>config-client配置：</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">        <span class="token comment">&lt;!-- eureka-client --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p><p>ProviderApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@EnableEurekaClient</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p>bootstrap.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 配置config-server地址</span></span>
<span class="line"><span class="token comment"># 配置获得配置文件的名称等信息</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># 配置config-server地址</span></span>
<span class="line">      <span class="token comment">#uri: http://localhost:9527</span></span>
<span class="line">      <span class="token comment"># 配置获得配置文件的名称等信息</span></span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> config <span class="token comment"># 文件名</span></span>
<span class="line">      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment"># profile指定，  config-dev.yml</span></span>
<span class="line">      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment"># 分支</span></span>
<span class="line">      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">service-id</span><span class="token punctuation">:</span> CONFIG<span class="token punctuation">-</span>SERVER</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">management</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">web</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</p><p><strong>config-server配置:</strong></p><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">    <span class="token comment">&lt;!-- eureka-client --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5</p><p>ConfigServerApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@EnableEurekaClient</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>1</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4</p><p>测试：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418093808497.b6035ff7.png" alt="image-20220418093808497"></p><h2 id="第十四章-springcloud-bus消息总线" tabindex="-1"><a class="header-anchor" href="#第十四章-springcloud-bus消息总线"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0-springcloud-bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF" target="_blank" rel="noopener noreferrer">#</a>第十四章 SpringCloud Bus消息总线</span></a></h2><p>远程的配置文件更新了，运维只需要发一个请求，所有用到这个配置文件的几百个应用更新了。</p><h3 id="一、bus-概述" tabindex="-1"><a class="header-anchor" href="#一、bus-概述"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81bus-%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">#</a>一、Bus 概述</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418094548555.e5074738.png" alt="image-20220418094548555"></p><p>Spring Cloud Bus 是用轻量的消息中间件将分布式的节点连接起来，可以用于广播配置文件的更改或者服务的监控管理。关键的思想就是，消息总线可以为微服务做监控，也可以实现应用程序之间相通信。</p><p>Spring Cloud Bus 可选的消息中间件包括 RabbitMQ 和 Kafka 。</p><h3 id="二、rabbitmq-回顾" tabindex="-1"><a class="header-anchor" href="#二、rabbitmq-回顾"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81rabbitmq-%E5%9B%9E%E9%A1%BE" target="_blank" rel="noopener noreferrer">#</a>二、RabbitMQ 回顾</span></a></h3><p>message queue</p><p>异步、解耦、削峰填谷</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200613074044506.2b1f2272.png" alt="image-20200613074044506"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200613074052830.5aedea61.png" alt="image-20200613074052830"></p><p>RabbitMQ 提供了 6 种工作模式：简单模式、work queues、Publish/Subscribe 发布与订阅模式、Routing</p><p>路由模式、Topics 主题模式、RPC 远程调用模式（远程调用，不太算 MQ；暂不作介绍）。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200613074109383.dc1a9615.png" alt="image-20200613074109383"></p><h3 id="三、bus-快速入门-运维" tabindex="-1"><a class="header-anchor" href="#三、bus-快速入门-运维"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81bus-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-%E8%BF%90%E7%BB%B4" target="_blank" rel="noopener noreferrer">#</a>三、Bus 快速入门-运维</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418094548555.e5074738.png" alt="image-20220418094548555"></p><p>1、分别在 config-server 和 config-client中引入 bus依赖：bus-amqp</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- bus --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bus-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9</p><p>2、分别在 config-server 和 config-client中配置 RabbitMQ</p><p>server 的配置文件：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>server</span>
<span class="line">  <span class="token comment"># spring cloud config</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># git 的 远程仓库地址</span></span>
<span class="line">        <span class="token key atrule">git</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//gitee.com/ydlclass_cch/ydlclass<span class="token punctuation">-</span>configs.git</span>
<span class="line">      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment"># 分支配置</span></span>
<span class="line">  <span class="token comment">#配置rabbitmq信息</span></span>
<span class="line">  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost</span>
<span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span></span>
<span class="line">    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest</span>
<span class="line">    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest</span>
<span class="line">    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将自己注册到eureka中</span></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 暴露bus的刷新端点</span></span>
<span class="line"><span class="token key atrule">management</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">web</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;bus-refresh&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34</p><p>client的配置文件 bootstrap.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 配置config-server地址</span></span>
<span class="line"><span class="token comment"># 配置获得配置文件的名称等信息</span></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># 配置config-server地址</span></span>
<span class="line">      <span class="token comment"># uri: http://localhost:9527</span></span>
<span class="line">      <span class="token comment"># 配置获得配置文件的名称等信息</span></span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> config <span class="token comment"># 文件名</span></span>
<span class="line">      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment"># profile指定，  config-dev.yml</span></span>
<span class="line">      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment"># 分支</span></span>
<span class="line">      <span class="token comment"># 从注册中心去寻找config-server地址</span></span>
<span class="line">      <span class="token key atrule">discovery</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">service-id</span><span class="token punctuation">:</span> CONFIG<span class="token punctuation">-</span>SERVER</span>
<span class="line">  <span class="token comment">#配置rabbitmq信息</span></span>
<span class="line">  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost</span>
<span class="line">    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span></span>
<span class="line">    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest</span>
<span class="line">    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest</span>
<span class="line">    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">management</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">web</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;*&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28</p><ol><li><p>在config-server中设置暴露监控断点：bus-refresh</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># 暴露bus的刷新端点</span></span>
<span class="line"><span class="token key atrule">management</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">web</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&#39;bus-refresh&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6</p></li></ol><p>bus自动在mq中建立交换机</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418095857082.c146dc82.png" alt="image-20220418095857082"></p><p>只要微服务起起来，自动在mq中，建立队列，和交换机绑定</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418100013437.ff032e6b.png" alt="image-20220418100013437"></p><p>启动测试</p><p>1.git配置改变</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418104835631.9d49fe01.png" alt="image-20220418104835631"></p><p>2.往配置中心发请求</p><p>curl -X POST http://localhost:9527/actuator/bus-refresh</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnIAAAA5CAYAAACyLsYTAAAHTElEQVR4nO3dW27kKhCAYXeURy/KS/cCsqeehyPrIBqKAgpwtf9PijTxhauNqzE9ee37/t4AAADgzs/qAgAAAKANgRwAAIBTBHIAAABOEcgBAAA4RSAHAADgFIEcAACAUwRyAAAATnUHcud5WpRjGe/lBzBXacxgTPlu9K+M9pnvte/7O9Xwx3GoEznPM3l8mO61P7VttVz5a4/pyX/b2tuj93zPRvbL6nL03j+5ATU+r5RmbnyQBuw79MkIpX6WxsKVbbI6/x7S9am5xuNjpH25fMLjvbbjDLTPGr+phreKqK/BPkw/te2bPDmoWmH19TTy02fv/ZM7NtwW7y/9fm0L80ilqfGEe2X17ISUv4f211yPtYF16p6K96Ofh+urxuz61OTHGrkKmhu8pZOP4+i6OHrP37bxg9eMgGcFi7YvpR/WzTJozT0UtW2ZK4e2fLWz/j37Vxl9ffTkP7Nc1pMDVkpB3iyex9+cbwngtu3/62Lms6am/X5SB+deDUjT0HcdSDVK5f/mGcRv4f0a9OQb7wVpfAuPaXmtijJN+69G/8qe0j53rOPv6gJsW34NTm5/br1Qbi1F7xrAktwApFlDpFn/oa2btK5Dk388ldvSvtJritxUcW//xsfUrtdM1SWV36r1nWHesweRWa+uNdeW1F+p/am+vOMgLK3hSh1Tu8axtgza+zO3PzxGc//3kspeO+vbUrbaMbjl+s0dU8p/5vgrqa2LxfO7NT6o7Z+e9FP7S8ck677v+9vi5+/vT7093Na7//o9d47mfKn8pfRqyl+bTqputeW3qr9FPVrLJ+WvSVP63Sr/UplKbRv/aK6D1vRb+0R7j7SUr+f6LNWl5tpprV9P+TTXX+53i/uv5/6wGF9q2q3Unz391LKv5dq1HL/vMv623n8W8UFp/JwRH7Smr61fqSxmM3KWn9xb15lpz6+dzdm2tWtwrD/BWrZv6ZOTFW3/9i6O7s2/J91RLO/JEbNzo9sg7jtPr4BK16/F/Xfn/qydGS/Nykvje++4kGp/q/GnNf8R+dSW3/r+aynLqPF7RPot18vyV6vxjXltC/VcoJr0JanAwJPe+mvkXkfO5ukBXSOs1+o6eguEnmDl/TdjfLFIb+Q1u3r8W53/SDOfX6OUllhZ1C/734+0fjppObeUv3WEmyujpvweH2RW/Ztyl7a4Szm+De167y853KF/Ro4vJZq8esszYibPyur8Z5Rh9PU1842AZn9L/T7++xFpWnpE5NqSZs05sz+h3O0T0ej2bTnPuo2kCz/1iUfK/479l3o1YSHXNqsfDCWl+kv9PXt861Vz/a6cDeo9R2p/Tf/l9ucmKkbILVqvGX9K+y3GrpXPRE3/Sb/PMHOGziqvj7/sUFoj1vLpR/utkFwZcue3nJs6Jj4+lX7NttINXXoYW+QV1kfaH4r7WHtuql6l41Lb4zy0/asJPKRrXNOmmnNzx7TSXn8159ceV3uP1S5biM/TlKVmjLquj5Zzw/OlOtQ8mHJ5SPvjY6R2qbmHW8a3OP+e8UW7T3tuan/uXtb2s3bG70pTM8a1XIPhubk+vuP4q7n/pPr1jK+1z6/UMdr7Z3T6pfHxte/7+yOlTh4+1Uu8lx/Af3rv5d5ADr7RvzLa5x74yw4AvtL16bXn9UXt+hZ8F/pXRvvcw5AZOQAAAIzHjBwAAIBTBHIAAABOEcgBAAA4RSAHAADgFIEcAACAUwRyAAAAThHIAQAAOEUgBwAA4BSBHAAAgFMEcgAAAE4RyAEAADhFIAcAAOAUgRwAAIBTBHIAAABOEcgBAAA4RSAHAADgFIEcAACAU92B3HmeFuVYxnv5AQDAc732fX+ngpnjONSJnOeZPD5M99qf2rZarvy1x/Tkv23t7dF7vmcj+wUAgLv7uR6E4Y+VK60wzdS2b3KeJ7N8Ex3HQXsDAB6LNXIVNAFDS4DaG0BbBOCjg6GR6RPMAQCe6icVAORek+Yelt4fpKXy8/ru/rxfgwAAtPhdXYBtS8/WhIFTvD+33i63/q53DWBJLoCQAgvNmsFw7Zumbrk6SfUP98Vr7VraN1eHVPq58tXmHx9D0A0AeAp1IDdyoX/p4Z/aH75OvGYLc8FJKXDQSgUKUvrx8al/p8oc5yflKZ1fKl98fnxcS/vGv0vpS+XT9m+MYA4A8CRma+QsX221rjPTni/N5uSs/BKDdVBi2b6lmU8r2v4liAMAPMnyV6upAMpqBk2bviQ14+RJb/01cq+AZyOIAwA8za/0aqtW62utUv69D2dt/TTl9/jqzqp/U+7SFncpBwAAM328WpXWMo2YbWlJs+ac2TNEd5uxG92+LedZtxFBHADgqT7+skPpm48tfwFBerWn+Uap5luN2nNTx8THS98o1WyTvrggHWOZV1gfaX9I+taqdG6qXqXjUtvjPLT9SxAHAHiq177vb+tEvT9cvZcfAAA8A3/ZAQAAwKkhM3IAAAAYjxk5AAAApwjkAAAAnPoHQ79Y4agfxf4AAAAASUVORK5CYII=" alt="image-20220418104622908"></p><p>3.微服务自动重启</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418104702500.bbdf21ca.png" alt="image-20220418104702500"></p><p>4.访问微服务，发现配置已经改变</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418104819862.b829a33e.png" alt="image-20220418104819862"></p><h2 id="第十五章-springcloud-stream消息驱动" tabindex="-1"><a class="header-anchor" href="#第十五章-springcloud-stream消息驱动"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%8D%81%E4%BA%94%E7%AB%A0-springcloud-stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8" target="_blank" rel="noopener noreferrer">#</a>第十五章 SpringCloud Stream消息驱动</span></a></h2><h3 id="一、stream-概述" tabindex="-1"><a class="header-anchor" href="#一、stream-概述"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81stream-%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">#</a>一、Stream 概述</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418111329857.7c8547d2.png" alt="image-20220418111329857"></p><p>1.Spring Cloud Stream 是一个构建消息驱动微服务应用的框架。</p><p>2.Stream 解决了开发人员<strong>无感知</strong>的使用消息中间件的问题，因为Stream对消息中间件的进一步封装，可以做到代码层面对中间件的无感知，甚至于<strong>动态的切换中间件</strong>，使得微服务开发的高度解耦，服务可以关注更多自己的业务流程。</p><p>3.Spring Cloud Stream目前支持两种消息中间件RabbitMQ和Kafka</p><p>就像jdbc一样</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418111643163.1006efdf.png" alt="image-20220418111643163"></p><p><strong>Stream 组件</strong></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200613074759833.b4428b4e.png" alt="image-20200613074759833"></p><p>Spring Cloud Stream 构建的应用程序与消息中间件之间是通过绑定器 Binder 相关联的。绑定器对于应用程序而言起到了隔离作用， 它使得不同消息中间件的实现细节对应用程序来说是透明的。</p><p>binding 是我们通过配置把应用和spring cloud stream 的 binder 绑定在一起</p><p>output：发送消息 Channel，内置 Source接口</p><p>input：接收消息 Channel，内置 Sink接口</p><h3 id="二、stream-消息生产者" tabindex="-1"><a class="header-anchor" href="#二、stream-消息生产者"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81stream-%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E8%80%85" target="_blank" rel="noopener noreferrer">#</a>二、Stream 消息生产者</span></a></h3><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>stream-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>stream-producer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">&lt;!--spring boot web--&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">        <span class="token comment">&lt;!-- stream --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-stream-rabbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32</p><p>ProducerApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>stream</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerApp</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ProducerApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">stream</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># 定义绑定器，绑定到哪个消息中间件上</span></span>
<span class="line">      <span class="token key atrule">binders</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">ydlclass_binder</span><span class="token punctuation">:</span> <span class="token comment"># 自定义的绑定器名称</span></span>
<span class="line">          <span class="token key atrule">type</span><span class="token punctuation">:</span> rabbit <span class="token comment"># 绑定器类型</span></span>
<span class="line">          <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token comment"># 指定mq的环境</span></span>
<span class="line">            <span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost</span>
<span class="line">                <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span></span>
<span class="line">                <span class="token key atrule">username</span><span class="token punctuation">:</span> guest</span>
<span class="line">                <span class="token key atrule">password</span><span class="token punctuation">:</span> guest</span>
<span class="line">                <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /</span>
<span class="line">      <span class="token key atrule">bindings</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">output</span><span class="token punctuation">:</span> <span class="token comment"># channel名称</span></span>
<span class="line">          <span class="token key atrule">binder</span><span class="token punctuation">:</span> ydlclass_binder <span class="token comment">#指定使用哪一个binder</span></span>
<span class="line">          <span class="token key atrule">destination</span><span class="token punctuation">:</span> ydlclass_exchange <span class="token comment"># 消息目的地</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22</p><p>消息发送类 MessageProducer</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>producer</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableBinding</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Source</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">MessageChannel</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">MessageBuilder</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token annotation punctuation">@EnableBinding</span><span class="token punctuation">(</span><span class="token class-name">Source</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment">//这个类是stream的发送者</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageProducer</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token class-name">MessageChannel</span> output<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        output<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MessageProducer 确实发了消息了！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28</p><p>调用的controller ProducerController</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">MessageProducer</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * @Created by IT李老师</span>
<span class="line"> * 公主号 “元动力课堂”</span>
<span class="line"> * 个人微 itlils</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProducerController</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token class-name">MessageProducer</span> messageProducer<span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//业务逻辑</span></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/send&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//发消息</span></span>
<span class="line">        <span class="token class-name">String</span> msg<span class="token operator">=</span><span class="token string">&quot;使用stream来发消息了！&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        messageProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&quot;success!&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418114016165.e7af66ff.png" alt="image-20220418114016165"></p><h3 id="三、stream-消息消费者" tabindex="-1"><a class="header-anchor" href="#三、stream-消息消费者"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%89%E3%80%81stream-%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%80%85" target="_blank" rel="noopener noreferrer">#</a>三、Stream 消息消费者</span></a></h3><p>pom</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>stream-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ydlclass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>stream-consumer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">&lt;!--spring boot web--&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">        <span class="token comment">&lt;!-- stream --&gt;</span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-stream-rabbit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</p><p>ConsumerApp</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>stream</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerApp</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConsumerApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12</p><p>application.yml</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">stream</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># 定义绑定器，绑定到哪个消息中间件上</span></span>
<span class="line">      <span class="token key atrule">binders</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">ydlclass_binder</span><span class="token punctuation">:</span> <span class="token comment"># 自定义的绑定器名称</span></span>
<span class="line">          <span class="token key atrule">type</span><span class="token punctuation">:</span> rabbit <span class="token comment"># 绑定器类型</span></span>
<span class="line">          <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token comment"># 指定mq的环境</span></span>
<span class="line">            <span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">              <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost</span>
<span class="line">                <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span></span>
<span class="line">                <span class="token key atrule">username</span><span class="token punctuation">:</span> guest</span>
<span class="line">                <span class="token key atrule">password</span><span class="token punctuation">:</span> guest</span>
<span class="line">                <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /</span>
<span class="line">      <span class="token key atrule">bindings</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">input</span><span class="token punctuation">:</span> <span class="token comment"># channel名称</span></span>
<span class="line">          <span class="token key atrule">binder</span><span class="token punctuation">:</span> ydlclass_binder <span class="token comment">#指定使用哪一个binder</span></span>
<span class="line">          <span class="token key atrule">destination</span><span class="token punctuation">:</span> ydlclass_exchange <span class="token comment"># 消息目的地</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24</p><p>消息接收类 MessageListener</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>consumer</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableBinding</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">StreamListener</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Sink</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 消息接收类</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@EnableBinding</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Sink</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageListener</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@StreamListener</span><span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token punctuation">.</span><span class="token constant">INPUT</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22</p><p>测试</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418154602979.4f1f002f.png" alt="image-20220418154602979"></p><h2 id="第十六章-springcloud-sleuth分布式请求链路追踪" tabindex="-1"><a class="header-anchor" href="#第十六章-springcloud-sleuth分布式请求链路追踪"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E7%AC%AC%E5%8D%81%E5%85%AD%E7%AB%A0-springcloud-sleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA" target="_blank" rel="noopener noreferrer">#</a>第十六章 SpringCloud Sleuth分布式请求链路追踪</span></a></h2><h3 id="一、概述-2" tabindex="-1"><a class="header-anchor" href="#一、概述-2"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0-2" target="_blank" rel="noopener noreferrer">#</a>一、概述</span></a></h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418155007573.1c1b8bdd.png" alt="image-20220418155007573"></p><p>Spring Cloud Sleuth 其实是一个工具,它在整个分布式系统中能跟踪一个用户请求的过程，捕获这些跟踪数据，就能构建微服务的整个调用链的视图，这是调试和监控微服务的关键工具。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">耗时分析 </span>
<span class="line">可视化错误 </span>
<span class="line">链路优化</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3</p><p>Zipkin 是 Twitter 的一个开源项目，它致力于收集服务的定时数据，以解决微服务架构中的延迟问题，包括数据的收集、存储、查找和展现。</p><h3 id="二、快速入门-1" tabindex="-1"><a class="header-anchor" href="#二、快速入门-1"><span><a href="https://www.ydlclass.com/doc21xnv/springcloud/SpringCloud.html#%E4%BA%8C%E3%80%81%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-1" target="_blank" rel="noopener noreferrer">#</a>二、快速入门</span></a></h3><ol><li><p>安装启动zipkin。 java –jar zipkin.jar</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418185033323.76dc027c.png" alt="image-20220418185033323"></p></li><li><p>访问zipkin web界面。 http://localhost:9411/</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20200613080015686.e297485f.png" alt="image-20200613080015686"></p></li><li><p>在服务提供方和消费方分别引入 sleuth 和 zipkin 依赖</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">        <span class="token comment">&lt;!-- sleuth-zipkin --&gt;</span></span>
<span class="line">        <span class="token comment">&lt;!--&lt;dependency&gt;</span>
<span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
<span class="line">            &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt;</span>
<span class="line">        &lt;/dependency&gt;--&gt;</span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-zipkin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10</p></li><li><p>分别配置服务提供方和消费方。</p><p>provider</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka</span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> feign<span class="token punctuation">-</span>provider</span>
<span class="line">  <span class="token key atrule">zipkin</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9411/  <span class="token comment"># 设置zipkin的服务端路径</span></span>
<span class="line">  <span class="token key atrule">sleuth</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">sampler</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 采集率 默认 0.1 百分之十。</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15</p><p>consumer</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">eureka</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">instance</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 主机名</span></span>
<span class="line">  <span class="token key atrule">client</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">service-url</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka</span>
<span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> feign<span class="token punctuation">-</span>consumer <span class="token comment"># 设置当前应用的名称。将来会在eureka中Application显示。将来需要使用该名称来获取路径</span></span>
<span class="line">  <span class="token key atrule">zipkin</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9411/  <span class="token comment"># 设置zipkin的服务端路径</span></span>
<span class="line">  <span class="token key atrule">sleuth</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">sampler</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 采集率 默认 0.1 百分之十。</span></span>
<span class="line"><span class="token key atrule">logging</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">level</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">com.ydlclass</span><span class="token punctuation">:</span> debug</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</p></li><li><p>启动，测试</p></li></ol><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418160537372.c7993f21.png" alt="image-20220418160537372"></p><p>调用关系图也能展现</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220418160602065.25c4ceff.png" alt="image-20220418160602065"></p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 2506956864@qq.com">zqb</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blogs/assets/app-CcpQiU3r.js" defer></script>
  </body>
</html>
